<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PhishLens â€” URL Phishing Detection Research</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap');

  :root {
    --bg:       #050810;
    --panel:    #0a0f1e;
    --border:   #1a2340;
    --accent:   #00e5ff;
    --danger:   #ff3366;
    --safe:     #00ff9d;
    --warn:     #ffb800;
    --text:     #e2e8f0;
    --muted:    #4a5568;
    --glow:     rgba(0,229,255,0.15);
    --glow2:    rgba(255,51,102,0.15);
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  html, body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    height: 100%;
    overflow-x: hidden;
  }

  /* â”€â”€ CANVAS BACKGROUND â”€â”€ */
  #bg-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
    pointer-events: none;
  }

  /* â”€â”€ LAYOUT â”€â”€ */
  #app {
    position: relative;
    z-index: 1;
    min-height: 100vh;
  }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 40px;
    border-bottom: 1px solid var(--border);
    background: rgba(5,8,16,0.85);
    backdrop-filter: blur(20px);
    position: sticky; top: 0; z-index: 100;
  }

  .logo {
    display: flex; align-items: center; gap: 12px;
  }
  .logo-icon {
    width: 36px; height: 36px;
    background: linear-gradient(135deg, var(--accent), var(--danger));
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
  }
  .logo-text {
    font-size: 22px; font-weight: 800; letter-spacing: -0.5px;
  }
  .logo-text span { color: var(--accent); }

  .header-badge {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    border: 1px solid var(--border);
    padding: 4px 10px;
    border-radius: 20px;
    letter-spacing: 1px;
  }

  nav {
    display: flex; gap: 6px;
  }
  .nav-btn {
    background: none;
    border: 1px solid transparent;
    color: var(--muted);
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    padding: 6px 14px;
    border-radius: 6px;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: all 0.2s;
  }
  .nav-btn:hover, .nav-btn.active {
    color: var(--accent);
    border-color: var(--accent);
    background: var(--glow);
  }

  /* â”€â”€ SECTIONS â”€â”€ */
  section {
    display: none;
    padding: 40px;
    max-width: 1400px;
    margin: 0 auto;
    animation: fadeUp 0.4s ease;
  }
  section.active { display: block; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* â”€â”€ SECTION TITLES â”€â”€ */
  .section-title {
    font-size: 13px;
    font-family: 'Space Mono', monospace;
    color: var(--accent);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  .section-headline {
    font-size: 36px;
    font-weight: 800;
    line-height: 1.1;
    margin-bottom: 32px;
  }
  .section-headline em { color: var(--accent); font-style: normal; }

  /* â”€â”€ CARDS â”€â”€ */
  .card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 24px;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .card:hover {
    border-color: rgba(0,229,255,0.3);
    box-shadow: 0 0 30px rgba(0,229,255,0.06);
  }
  .card-title {
    font-size: 11px;
    font-family: 'Space Mono', monospace;
    color: var(--muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  /* â”€â”€ OVERVIEW HERO â”€â”€ */
  .hero-canvas-wrap {
    width: 100%;
    height: 320px;
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid var(--border);
    margin-bottom: 32px;
    position: relative;
    background: #020408;
  }
  #hero-canvas { width: 100%; height: 100%; display: block; }
  .hero-overlay {
    position: absolute; inset: 0;
    background: linear-gradient(180deg, transparent 60%, var(--bg) 100%);
    pointer-events: none;
  }
  .hero-label {
    position: absolute; bottom: 20px; left: 24px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 1px;
  }

  /* â”€â”€ STAT GRID â”€â”€ */
  .stat-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 28px;
  }
  .stat-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px 22px;
    position: relative;
    overflow: hidden;
    transition: all 0.25s;
  }
  .stat-card::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--accent);
  }
  .stat-card.danger::before { background: var(--danger); }
  .stat-card.warn::before   { background: var(--warn); }
  .stat-card.safe::before   { background: var(--safe); }
  .stat-card:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0,0,0,0.4); }
  .stat-label {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-bottom: 10px;
  }
  .stat-value {
    font-size: 32px;
    font-weight: 800;
    color: var(--accent);
    line-height: 1;
  }
  .stat-card.danger .stat-value { color: var(--danger); }
  .stat-card.warn .stat-value   { color: var(--warn); }
  .stat-card.safe .stat-value   { color: var(--safe); }
  .stat-sub {
    font-size: 11px;
    color: var(--muted);
    margin-top: 6px;
    font-family: 'Space Mono', monospace;
  }

  /* â”€â”€ EXPERIMENT CARDS â”€â”€ */
  .exp-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 32px;
  }
  .exp-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 28px;
    cursor: pointer;
    transition: all 0.25s;
    position: relative;
    overflow: hidden;
  }
  .exp-card::after {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(circle at 50% 0%, rgba(0,229,255,0.05), transparent 60%);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .exp-card:hover::after { opacity: 1; }
  .exp-card:hover { border-color: rgba(0,229,255,0.4); transform: translateY(-3px); }
  .exp-card.e2 { border-color: rgba(0,255,157,0.2); }
  .exp-card.e2::after { background: radial-gradient(circle at 50% 0%, rgba(0,255,157,0.06), transparent 60%); }
  .exp-badge {
    display: inline-block;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    padding: 4px 10px;
    border-radius: 20px;
    border: 1px solid var(--accent);
    color: var(--accent);
    margin-bottom: 14px;
  }
  .exp-card.e2 .exp-badge { border-color: var(--safe); color: var(--safe); }
  .exp-card.e3 .exp-badge { border-color: var(--warn); color: var(--warn); }
  .exp-name {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 6px;
  }
  .exp-desc {
    font-size: 12px;
    color: var(--muted);
    line-height: 1.6;
    margin-bottom: 20px;
    font-family: 'Space Mono', monospace;
  }
  .metric-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .metric-key {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 1px;
  }
  .metric-val {
    font-size: 14px;
    font-weight: 700;
    color: var(--text);
  }
  .metric-bar {
    height: 3px;
    background: var(--border);
    border-radius: 2px;
    margin-bottom: 14px;
    overflow: hidden;
  }
  .metric-fill {
    height: 100%;
    border-radius: 2px;
    background: linear-gradient(90deg, var(--accent), rgba(0,229,255,0.4));
    transition: width 1s cubic-bezier(0.4,0,0.2,1);
  }
  .exp-card.e2 .metric-fill { background: linear-gradient(90deg, var(--safe), rgba(0,255,157,0.4)); }
  .exp-card.e3 .metric-fill { background: linear-gradient(90deg, var(--warn), rgba(255,184,0,0.4)); }

  /* â”€â”€ CONFUSION MATRIX â”€â”€ */
  .cm-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3px;
    max-width: 200px;
  }
  .cm-cell {
    padding: 14px 10px;
    text-align: center;
    border-radius: 6px;
    font-family: 'Space Mono', monospace;
  }
  .cm-cell .cm-num { font-size: 20px; font-weight: 700; display: block; }
  .cm-cell .cm-lbl { font-size: 9px; color: var(--muted); letter-spacing: 1px; }
  .cm-tp { background: rgba(0,255,157,0.12); color: var(--safe); }
  .cm-tn { background: rgba(0,255,157,0.12); color: var(--safe); }
  .cm-fp { background: rgba(255,184,0,0.10); color: var(--warn); }
  .cm-fn { background: rgba(255,51,102,0.12); color: var(--danger); }

  /* â”€â”€ FEATURE IMPORTANCE VIZ â”€â”€ */
  #feat-canvas-wrap {
    width: 100%;
    height: 460px;
    border-radius: 14px;
    overflow: hidden;
    border: 1px solid var(--border);
    background: #020408;
    position: relative;
  }
  #feat-canvas { width: 100%; height: 100%; display: block; }
  .feat-legend {
    position: absolute; top: 16px; right: 16px;
    display: flex; flex-direction: column; gap: 8px;
  }
  .legend-item {
    display: flex; align-items: center; gap: 8px;
    font-family: 'Space Mono', monospace;
    font-size: 10px; color: var(--muted); letter-spacing: 0.5px;
  }
  .legend-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }

  /* â”€â”€ TWO-COL LAYOUT â”€â”€ */
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .three-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }

  /* â”€â”€ ROC CANVAS â”€â”€ */
  #roc-canvas { width: 100%; height: 300px; display: block; }

  /* â”€â”€ TREE VISUALIZATION â”€â”€ */
  #tree-canvas-wrap {
    width: 100%;
    height: 500px;
    border-radius: 14px;
    overflow: hidden;
    border: 1px solid var(--border);
    background: #020408;
    position: relative;
    cursor: grab;
  }
  #tree-canvas-wrap:active { cursor: grabbing; }
  #tree-canvas { width: 100%; height: 100%; display: block; }
  .tree-tooltip {
    position: absolute;
    background: rgba(10,15,30,0.96);
    border: 1px solid var(--accent);
    border-radius: 8px;
    padding: 10px 14px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s;
    max-width: 220px;
    line-height: 1.6;
    z-index: 10;
  }

  /* â”€â”€ PREDICTOR â”€â”€ */
  .predictor-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
    margin-bottom: 28px;
  }
  .input-group {
    display: flex; flex-direction: column; gap: 6px;
  }
  .input-label {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 1px;
    text-transform: uppercase;
  }
  .input-field {
    background: #0d1220;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    padding: 10px 14px;
    outline: none;
    transition: border-color 0.2s;
    width: 100%;
  }
  .input-field:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--glow); }
  .range-wrap { display: flex; align-items: center; gap: 12px; }
  .input-range {
    flex: 1;
    -webkit-appearance: none;
    background: var(--border);
    height: 4px;
    border-radius: 2px;
    outline: none;
  }
  .input-range::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px; height: 14px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
  }
  .range-val {
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    color: var(--accent);
    min-width: 36px;
    text-align: right;
  }

  .predict-btn {
    background: linear-gradient(135deg, var(--accent), #0080ff);
    color: var(--bg);
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 1px;
    border: none;
    border-radius: 10px;
    padding: 14px 32px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex; align-items: center; gap: 10px;
  }
  .predict-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0,229,255,0.3); }

  .result-panel {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 28px;
    display: none;
    animation: fadeUp 0.3s ease;
  }
  .result-panel.visible { display: block; }
  .result-verdict {
    font-size: 42px;
    font-weight: 800;
    margin-bottom: 8px;
  }
  .result-verdict.phish { color: var(--danger); }
  .result-verdict.legit { color: var(--safe); }
  .result-conf { font-family: 'Space Mono', monospace; font-size: 12px; color: var(--muted); margin-bottom: 20px; }

  /* â”€â”€ PROBABILITY BAR â”€â”€ */
  .prob-bar-wrap {
    height: 8px;
    background: var(--border);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 6px;
  }
  .prob-fill {
    height: 100%;
    border-radius: 4px;
    background: linear-gradient(90deg, var(--safe), var(--warn), var(--danger));
    transition: width 0.8s cubic-bezier(0.4,0,0.2,1);
  }
  .prob-labels {
    display: flex;
    justify-content: space-between;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--muted);
  }

  /* â”€â”€ SIGNAL BARS â”€â”€ */
  .signal-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-top: 16px;
  }
  .signal-item {
    background: #060b18;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px;
  }
  .signal-name {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    color: var(--muted);
    margin-bottom: 6px;
    letter-spacing: 0.5px;
  }
  .signal-val {
    font-size: 16px;
    font-weight: 700;
  }
  .signal-val.high { color: var(--danger); }
  .signal-val.mid  { color: var(--warn); }
  .signal-val.low  { color: var(--safe); }

  /* â”€â”€ TOOLTIP â”€â”€ */
  #global-tooltip {
    position: fixed;
    background: rgba(10,15,30,0.96);
    border: 1px solid var(--accent);
    border-radius: 8px;
    padding: 8px 12px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 9999;
    max-width: 260px;
    line-height: 1.6;
  }

  /* â”€â”€ SCROLLBAR â”€â”€ */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  /* â”€â”€ RESPONSIVE â”€â”€ */
  @media (max-width: 900px) {
    .stat-grid  { grid-template-columns: repeat(2,1fr); }
    .exp-grid   { grid-template-columns: 1fr; }
    .two-col    { grid-template-columns: 1fr; }
    .three-col  { grid-template-columns: 1fr; }
    .predictor-grid { grid-template-columns: 1fr; }
    section { padding: 20px; }
    header  { padding: 14px 20px; }
    .logo-text { font-size: 18px; }
  }
</style>
</head>
<body>

<canvas id="bg-canvas"></canvas>

<div id="app">

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-icon">ðŸ›¡</div>
    <div class="logo-text">Phish<span>Lens</span></div>
  </div>
  <nav>
    <button class="nav-btn active" onclick="showSection('overview')">OVERVIEW</button>
    <button class="nav-btn" onclick="showSection('experiments')">EXPERIMENTS</button>
    <button class="nav-btn" onclick="showSection('features')">FEATURES</button>
    <button class="nav-btn" onclick="showSection('tree')">TREE</button>
    <button class="nav-btn" onclick="showSection('predictor')">PREDICTOR</button>
  </nav>
  <div class="header-badge">10,000 SAMPLES Â· 48 FEATURES Â· 3 MODELS</div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: OVERVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="overview" class="active">
  <div class="section-title">Research Dashboard</div>
  <div class="section-headline">Phishing Detection via<br><em>Interpretable URL Features</em></div>

  <!-- 3D Hero canvas -->
  <div class="hero-canvas-wrap">
    <canvas id="hero-canvas"></canvas>
    <div class="hero-overlay"></div>
    <div class="hero-label">LIVE 3D Â· URL FEATURE SPACE Â· PHISHING vs LEGITIMATE</div>
  </div>

  <!-- Stats -->
  <div class="stat-grid">
    <div class="stat-card safe">
      <div class="stat-label">Best Accuracy</div>
      <div class="stat-value">96.25%</div>
      <div class="stat-sub">Decision Tree Â· E2</div>
    </div>
    <div class="stat-card safe">
      <div class="stat-label">Best F1-Score</div>
      <div class="stat-value">0.9624</div>
      <div class="stat-sub">Decision Tree Â· E2</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ROC-AUC (E1)</div>
      <div class="stat-value">0.9869</div>
      <div class="stat-sub">Logistic Regression</div>
    </div>
    <div class="stat-card warn">
      <div class="stat-label">Min FPR</div>
      <div class="stat-value">3.6%</div>
      <div class="stat-sub">Legit sites blocked Â· E2</div>
    </div>
  </div>

  <!-- ROC + confusion -->
  <div class="two-col">
    <div class="card">
      <div class="card-title">ROC Curves â€” All Experiments</div>
      <canvas id="roc-canvas"></canvas>
    </div>
    <div class="card">
      <div class="card-title">Constraint Acknowledgments</div>
      <div style="display:flex; flex-direction:column; gap:12px; margin-top:8px;">
        <div class="constraint-item" style="display:flex;gap:14px;align-items:flex-start">
          <span style="color:var(--accent);font-size:18px;margin-top:2px">â—‹</span>
          <div>
            <div style="font-size:13px;font-weight:600;margin-bottom:3px">No Raw URL Parsing</div>
            <div style="font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;line-height:1.6">All 48 features are pre-computed numeric values. Original URLs not present in dataset.</div>
          </div>
        </div>
        <div class="constraint-item" style="display:flex;gap:14px;align-items:flex-start">
          <span style="color:var(--accent);font-size:18px;margin-top:2px">â—‹</span>
          <div>
            <div style="font-size:13px;font-weight:600;margin-bottom:3px">No Live Website Analysis</div>
            <div style="font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;line-height:1.6">No JavaScript execution, redirect following, or external service calls.</div>
          </div>
        </div>
        <div class="constraint-item" style="display:flex;gap:14px;align-items:flex-start">
          <span style="color:var(--accent);font-size:18px;margin-top:2px">â—‹</span>
          <div>
            <div style="font-size:13px;font-weight:600;margin-bottom:3px">Interpretable Models Only</div>
            <div style="font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;line-height:1.6">Logistic Regression Â· Decision Tree (depthâ‰¤5) Â· Shallow Random Forest. No neural nets or boosting.</div>
          </div>
        </div>
        <div class="constraint-item" style="display:flex;gap:14px;align-items:flex-start">
          <span style="color:var(--accent);font-size:18px;margin-top:2px">â—‹</span>
          <div>
            <div style="font-size:13px;font-weight:600;margin-bottom:3px">Balanced Dataset</div>
            <div style="font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;line-height:1.6">5,000 phishing + 5,000 legitimate. 80/20 stratified split. Seed = 42.</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: EXPERIMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="experiments">
  <div class="section-title">Experimental Results</div>
  <div class="section-headline">Three Controlled<br><em>Experiments</em></div>

  <div class="exp-grid">
    <!-- E1 -->
    <div class="exp-card e1">
      <div class="exp-badge">E1</div>
      <div class="exp-name">Logistic Regression</div>
      <div class="exp-desc">48 features Â· StandardScaler Â· L2 reg C=1.0 Â· lbfgs solver</div>
      <div class="metric-row"><span class="metric-key">ACCURACY</span><span class="metric-val">95.20%</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%" data-w="95.2"></div></div>
      <div class="metric-row"><span class="metric-key">F1-SCORE</span><span class="metric-val">0.9524</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%" data-w="95.24"></div></div>
      <div class="metric-row"><span class="metric-key">ROC-AUC</span><span class="metric-val">0.9869</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%" data-w="98.69"></div></div>
      <div class="metric-row"><span class="metric-key">CV F1 (5-fold)</span><span class="metric-val">0.9411 Â± 0.0037</span></div>
      <hr style="border:none;border-top:1px solid var(--border);margin:16px 0">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="metric-key" style="margin-bottom:6px">CONFUSION MATRIX</div>
          <div class="cm-grid">
            <div class="cm-cell cm-tn"><span class="cm-num">944</span><span class="cm-lbl">TN</span></div>
            <div class="cm-cell cm-fp"><span class="cm-num">56</span><span class="cm-lbl">FP</span></div>
            <div class="cm-cell cm-fn"><span class="cm-num">40</span><span class="cm-lbl">FN</span></div>
            <div class="cm-cell cm-tp"><span class="cm-num">960</span><span class="cm-lbl">TP</span></div>
          </div>
        </div>
        <div style="text-align:right">
          <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:4px">FPR</div>
          <div style="font-size:22px;font-weight:800;color:var(--warn)">5.6%</div>
          <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-top:10px;margin-bottom:4px">FNR</div>
          <div style="font-size:22px;font-weight:800;color:var(--danger)">4.0%</div>
        </div>
      </div>
    </div>

    <!-- E2 -->
    <div class="exp-card e2" style="border-color:rgba(0,255,157,0.25)">
      <div class="exp-badge" style="border-color:var(--safe);color:var(--safe)">E2 Â· BEST</div>
      <div class="exp-name">Decision Tree</div>
      <div class="exp-desc">depthâ‰¤5 Â· Gini Â· min_leaf=20 Â· fully interpretable path rules</div>
      <div class="metric-row"><span class="metric-key">ACCURACY</span><span class="metric-val" style="color:var(--safe)">96.25%</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%;background:linear-gradient(90deg,var(--safe),rgba(0,255,157,0.3))" data-w="96.25"></div></div>
      <div class="metric-row"><span class="metric-key">F1-SCORE</span><span class="metric-val" style="color:var(--safe)">0.9624</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%;background:linear-gradient(90deg,var(--safe),rgba(0,255,157,0.3))" data-w="96.24"></div></div>
      <div class="metric-row"><span class="metric-key">ROC-AUC</span><span class="metric-val">0.9830</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%;background:linear-gradient(90deg,var(--safe),rgba(0,255,157,0.3))" data-w="98.30"></div></div>
      <div class="metric-row"><span class="metric-key">CV F1 (5-fold)</span><span class="metric-val">0.9539 Â± 0.0078</span></div>
      <hr style="border:none;border-top:1px solid var(--border);margin:16px 0">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="metric-key" style="margin-bottom:6px">CONFUSION MATRIX</div>
          <div class="cm-grid">
            <div class="cm-cell cm-tn"><span class="cm-num">964</span><span class="cm-lbl">TN</span></div>
            <div class="cm-cell cm-fp"><span class="cm-num">36</span><span class="cm-lbl">FP</span></div>
            <div class="cm-cell cm-fn"><span class="cm-num">39</span><span class="cm-lbl">FN</span></div>
            <div class="cm-cell cm-tp"><span class="cm-num">961</span><span class="cm-lbl">TP</span></div>
          </div>
        </div>
        <div style="text-align:right">
          <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:4px">FPR</div>
          <div style="font-size:22px;font-weight:800;color:var(--safe)">3.6%</div>
          <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-top:10px;margin-bottom:4px">FNR</div>
          <div style="font-size:22px;font-weight:800;color:var(--safe)">3.9%</div>
        </div>
      </div>
    </div>

    <!-- E3 -->
    <div class="exp-card e3">
      <div class="exp-badge" style="border-color:var(--warn);color:var(--warn)">E3 Â· REDUCED</div>
      <div class="exp-name">LR Reduced</div>
      <div class="exp-desc">Top 6 features by RF importance Â· measures cost of feature reduction</div>
      <div class="metric-row"><span class="metric-key">ACCURACY</span><span class="metric-val" style="color:var(--warn)">87.00%</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%;background:linear-gradient(90deg,var(--warn),rgba(255,184,0,0.3))" data-w="87.0"></div></div>
      <div class="metric-row"><span class="metric-key">F1-SCORE</span><span class="metric-val" style="color:var(--warn)">0.8713</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%;background:linear-gradient(90deg,var(--warn),rgba(255,184,0,0.3))" data-w="87.13"></div></div>
      <div class="metric-row"><span class="metric-key">ROC-AUC</span><span class="metric-val">0.9352</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%;background:linear-gradient(90deg,var(--warn),rgba(255,184,0,0.3))" data-w="93.52"></div></div>
      <div class="metric-row"><span class="metric-key">CV F1 (5-fold)</span><span class="metric-val">0.8691 Â± 0.0045</span></div>
      <hr style="border:none;border-top:1px solid var(--border);margin:16px 0">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="metric-key" style="margin-bottom:6px">CONFUSION MATRIX</div>
          <div class="cm-grid">
            <div class="cm-cell cm-tn"><span class="cm-num">860</span><span class="cm-lbl">TN</span></div>
            <div class="cm-cell cm-fp"><span class="cm-num">140</span><span class="cm-lbl">FP</span></div>
            <div class="cm-cell cm-fn"><span class="cm-num">120</span><span class="cm-lbl">FN</span></div>
            <div class="cm-cell cm-tp"><span class="cm-num">880</span><span class="cm-lbl">TP</span></div>
          </div>
        </div>
        <div style="text-align:right">
          <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:4px">FPR</div>
          <div style="font-size:22px;font-weight:800;color:var(--danger)">14.0%</div>
          <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-top:10px;margin-bottom:4px">FNR</div>
          <div style="font-size:22px;font-weight:800;color:var(--danger)">12.0%</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Delta analysis -->
  <div class="card" style="margin-top:4px">
    <div class="card-title">E3 vs E1 â€” Cost of Feature Reduction (42 features removed)</div>
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-top:12px">
      <div>
        <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:6px">Î”Accuracy</div>
        <div style="font-size:26px;font-weight:800;color:var(--danger)">âˆ’8.20pp</div>
      </div>
      <div>
        <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:6px">Î”F1-Score</div>
        <div style="font-size:26px;font-weight:800;color:var(--danger)">âˆ’0.0811</div>
      </div>
      <div>
        <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:6px">Î”FPR</div>
        <div style="font-size:26px;font-weight:800;color:var(--danger)">+8.40pp</div>
      </div>
      <div>
        <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:6px">Interpretation</div>
        <div style="font-size:12px;color:var(--muted);font-family:'Space Mono',monospace;line-height:1.6;margin-top:4px">Signal is distributed. No single 6-feature subset captures all attack patterns.</div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: FEATURES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="features">
  <div class="section-title">Feature Analysis</div>
  <div class="section-headline">48 Handcrafted<br><em>URL Features</em></div>

  <div id="feat-canvas-wrap">
    <canvas id="feat-canvas"></canvas>
    <div class="feat-legend">
      <div class="legend-item"><div class="legend-dot" style="background:#ff3366"></div>HIGH IMPORTANCE (>10%)</div>
      <div class="legend-item"><div class="legend-dot" style="background:#ffb800"></div>MEDIUM (3â€“10%)</div>
      <div class="legend-item"><div class="legend-dot" style="background:#00e5ff"></div>LOW (<3%)</div>
      <div class="legend-item"><div class="legend-dot" style="background:rgba(255,255,255,0.15)"></div>HOVER FOR DETAILS</div>
    </div>
  </div>

  <div style="margin-top:24px" class="two-col">
    <div class="card">
      <div class="card-title">Top 8 Features by RF Importance</div>
      <div id="importance-list" style="margin-top:8px"></div>
    </div>
    <div class="card">
      <div class="card-title">Feature Groups</div>
      <div style="display:flex;flex-direction:column;gap:14px;margin-top:8px" id="group-breakdown"></div>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: TREE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="tree">
  <div class="section-title">Decision Tree Â· E2</div>
  <div class="section-headline">Interpretable<br><em>Decision Paths</em></div>

  <div id="tree-canvas-wrap">
    <canvas id="tree-canvas"></canvas>
    <div class="tree-tooltip" id="tree-tooltip"></div>
  </div>

  <div style="margin-top:20px" class="three-col">
    <div class="card">
      <div class="card-title">Root Split</div>
      <div style="font-size:13px;font-weight:600;color:var(--accent);margin-bottom:6px">PctExtNullSelfRedirectHyperlinksRT</div>
      <div style="font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;line-height:1.7">Rule-encoded fraction of null/self-redirect links. Phishing pages use decorative non-functional links to mimic legitimate site layouts.</div>
    </div>
    <div class="card">
      <div class="card-title">Secondary Splits</div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div style="font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--accent)">PctExtHyperlinks</span><br>
          <span style="color:var(--muted)">High external links = legitimate (content-rich pages link to sources)</span>
        </div>
        <div style="font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--accent)">InsecureForms</span><br>
          <span style="color:var(--muted)">HTTP form on HTTPS page = credential theft mechanic</span>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-title">Tree Constraints</div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div style="display:flex;justify-content:space-between;font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--muted)">max_depth</span><span style="color:var(--text)">5</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--muted)">criterion</span><span style="color:var(--text)">gini</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--muted)">min_samples_leaf</span><span style="color:var(--text)">20</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--muted)">max_leaves</span><span style="color:var(--text)">â‰¤32</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--muted)">human-auditable</span><span style="color:var(--safe)">YES</span>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: PREDICTOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="predictor">
  <div class="section-title">Interactive Demo</div>
  <div class="section-headline">URL Feature<br><em>Predictor</em></div>
  <div style="font-family:'Space Mono',monospace;font-size:11px;color:var(--muted);margin-bottom:28px;line-height:1.8">
    Adjust the 6 most important features identified by the reference Random Forest.<br>
    The predictor uses a logistic model calibrated on the full dataset (E1 coefficients).
  </div>

  <div class="two-col">
    <div>
      <div class="predictor-grid" id="slider-grid"></div>
      <button class="predict-btn" onclick="runPredictor()">
        <span>âš¡</span> ANALYZE URL FEATURES
      </button>
    </div>
    <div class="result-panel" id="result-panel">
      <div class="result-verdict" id="result-verdict">â€”</div>
      <div class="result-conf" id="result-conf">â€”</div>
      <div class="prob-bar-wrap"><div class="prob-fill" id="prob-fill" style="width:50%"></div></div>
      <div class="prob-labels"><span style="color:var(--safe)">LEGITIMATE</span><span style="color:var(--danger)">PHISHING</span></div>
      <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-top:16px;margin-bottom:8px">SIGNAL BREAKDOWN</div>
      <div class="signal-grid" id="signal-grid"></div>
      <div style="margin-top:18px;padding-top:14px;border-top:1px solid var(--border);font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);line-height:1.7">
        âš  Demo uses simplified logistic scoring. For production, run full 48-feature E1/E2 model.
      </div>
    </div>
  </div>
</section>

</div><!-- /app -->

<div id="global-tooltip"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RF_IMPORTANCE = [
  { feature: 'PctExtNullSelfRedirectHyperlinksRT', imp: 0.2225, group: 'RT' },
  { feature: 'PctExtHyperlinks',                   imp: 0.2007, group: 'Security' },
  { feature: 'PctExtResourceUrls',                  imp: 0.0944, group: 'Security' },
  { feature: 'FrequentDomainNameMismatch',           imp: 0.0919, group: 'Domain' },
  { feature: 'PctNullSelfRedirectHyperlinks',        imp: 0.0635, group: 'Security' },
  { feature: 'NumDash',                              imp: 0.0508, group: 'SuspChar' },
  { feature: 'ExtMetaScriptLinkRT',                  imp: 0.0393, group: 'RT' },
  { feature: 'InsecureForms',                        imp: 0.0309, group: 'Security' },
  { feature: 'NumNumericChars',                      imp: 0.0256, group: 'SuspChar' },
  { feature: 'SubmitInfoToEmail',                    imp: 0.0225, group: 'Security' },
  { feature: 'PathLevel',                            imp: 0.0201, group: 'URLLen' },
  { feature: 'NumQueryComponents',                   imp: 0.0163, group: 'SuspChar' },
  { feature: 'NumDots',                              imp: 0.0144, group: 'URLLen' },
  { feature: 'QueryLength',                          imp: 0.0138, group: 'URLLen' },
];

const LR_COEF = {
  'PctExtNullSelfRedirectHyperlinksRT': -3.407,
  'PctExtHyperlinks': -2.213,
  'PctExtResourceUrls': -0.978,
  'FrequentDomainNameMismatch': 2.071,
  'PctNullSelfRedirectHyperlinks': -1.176,
  'NumDash': -1.608,
};

const FEATURE_GROUPS = {
  'URL Length & Structure':    { count:7,  pct:14.6, color:'#4e79a7' },
  'Suspicious Characters':     { count:11, pct:18.2, color:'#f28e2b' },
  'Domain & Identity':         { count:8,  pct:21.3, color:'#e15759' },
  'Security Behaviors':        { count:16, pct:33.1, color:'#76b7b2' },
  'Rule-Based (RT)':           { count:6,  pct:12.8, color:'#59a14f' },
};

const FEATURE_DESC = {
  'PctExtNullSelfRedirectHyperlinksRT': 'RT-encoded fraction of null/self-redirect hyperlinks.\nHigh value on phishing pages â€” decorative non-functional links.',
  'PctExtHyperlinks':  'Fraction of hyperlinks pointing to external domains.\nCounterintuitively higher on legit (content-rich) pages.',
  'PctExtResourceUrls': 'Fraction of script/image resources from external domains.',
  'FrequentDomainNameMismatch': 'Binary: mismatch between displayed and actual domain.\nDirect deception signal.',
  'PctNullSelfRedirectHyperlinks': 'Fraction of null or self-redirect links (raw, not RT-encoded).',
  'NumDash': 'Count of hyphen characters in full URL.\nUsed to mimic brands: paypal-secure-login.com',
  'ExtMetaScriptLinkRT': 'RT-encoded ratio of external meta/script/link elements.',
  'InsecureForms': 'Binary: HTTP form action on an HTTPS page.\nDirect credential-theft indicator.',
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// NAV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showSection(id) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  event.target.classList.add('active');
  if (id === 'features') initFeatCanvas();
  if (id === 'tree')     initTreeCanvas();
  animateBars();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// BACKGROUND CANVAS (THREE.JS)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function initBG() {
  const canvas = document.getElementById('bg-canvas');
  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
  renderer.setSize(window.innerWidth, window.innerHeight);

  const scene  = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.z = 60;

  // Particle grid
  const count = 800;
  const geo   = new THREE.BufferGeometry();
  const pos   = new Float32Array(count * 3);
  const colors = new Float32Array(count * 3);
  for (let i = 0; i < count; i++) {
    pos[i*3]   = (Math.random()-0.5)*200;
    pos[i*3+1] = (Math.random()-0.5)*200;
    pos[i*3+2] = (Math.random()-0.5)*100;
    const t = Math.random();
    colors[i*3]   = t < 0.5 ? 0.0  : 1.0;
    colors[i*3+1] = t < 0.5 ? 0.9  : 0.2;
    colors[i*3+2] = t < 0.5 ? 1.0  : 0.4;
  }
  geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
  geo.setAttribute('color',    new THREE.BufferAttribute(colors, 3));
  const mat = new THREE.PointsMaterial({ size: 0.6, vertexColors: true, transparent: true, opacity: 0.25 });
  scene.add(new THREE.Points(geo, mat));

  // Connecting lines (sparse)
  const lineGeo = new THREE.BufferGeometry();
  const linePos = [];
  for (let i = 0; i < 60; i++) {
    const a = Math.floor(Math.random()*count)*3;
    const b = Math.floor(Math.random()*count)*3;
    linePos.push(pos[a],pos[a+1],pos[a+2], pos[b],pos[b+1],pos[b+2]);
  }
  lineGeo.setAttribute('position', new THREE.BufferAttribute(new Float32Array(linePos), 3));
  const lineMat = new THREE.LineBasicMaterial({ color: 0x1a2340, transparent: true, opacity: 0.4 });
  scene.add(new THREE.LineSegments(lineGeo, lineMat));

  let t = 0;
  (function animate() {
    requestAnimationFrame(animate);
    t += 0.0004;
    scene.rotation.y = t * 0.3;
    scene.rotation.x = Math.sin(t) * 0.05;
    renderer.render(scene, camera);
  })();

  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HERO CANVAS â€” 3D SCATTER PLOT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function initHero() {
  const canvas = document.getElementById('hero-canvas');
  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));

  const w = canvas.parentElement.clientWidth;
  const h = canvas.parentElement.clientHeight;
  renderer.setSize(w, h);

  const scene  = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(55, w / h, 0.1, 500);
  camera.position.set(0, 0, 40);

  // Generate clustered scatter: phishing vs legit
  const N = 400;
  const geoP = new THREE.BufferGeometry();
  const geoL = new THREE.BufferGeometry();
  const posP = new Float32Array(N*3), posL = new Float32Array(N*3);

  for (let i = 0; i < N; i++) {
    // Phishing cluster
    posP[i*3]   = (Math.random()-0.5)*18 + 6;
    posP[i*3+1] = (Math.random()-0.5)*14 + 2;
    posP[i*3+2] = (Math.random()-0.5)*14;
    // Legit cluster
    posL[i*3]   = (Math.random()-0.5)*18 - 6;
    posL[i*3+1] = (Math.random()-0.5)*14 - 2;
    posL[i*3+2] = (Math.random()-0.5)*14;
  }
  geoP.setAttribute('position', new THREE.BufferAttribute(posP, 3));
  geoL.setAttribute('position', new THREE.BufferAttribute(posL, 3));

  const matP = new THREE.PointsMaterial({ color: 0xff3366, size: 0.4, transparent: true, opacity: 0.7 });
  const matL = new THREE.PointsMaterial({ color: 0x00ff9d, size: 0.4, transparent: true, opacity: 0.7 });
  const ptP = new THREE.Points(geoP, matP);
  const ptL = new THREE.Points(geoL, matL);

  // Decision boundary plane
  const planeGeo = new THREE.PlaneGeometry(30, 24);
  const planeMat = new THREE.MeshBasicMaterial({
    color: 0x00e5ff, transparent: true, opacity: 0.04,
    side: THREE.DoubleSide, wireframe: false
  });
  const planeWireMat = new THREE.MeshBasicMaterial({
    color: 0x00e5ff, transparent: true, opacity: 0.12,
    side: THREE.DoubleSide, wireframe: true
  });
  const plane = new THREE.Mesh(planeGeo, planeMat);
  const planeWire = new THREE.Mesh(planeGeo, planeWireMat);
  plane.rotation.y = 0.3; planeWire.rotation.y = 0.3;

  scene.add(ptP, ptL, plane, planeWire);

  // Ambient particles
  const ambGeo = new THREE.BufferGeometry();
  const ambPos = new Float32Array(200*3);
  for (let i=0;i<200;i++) {
    ambPos[i*3]   = (Math.random()-0.5)*60;
    ambPos[i*3+1] = (Math.random()-0.5)*40;
    ambPos[i*3+2] = (Math.random()-0.5)*40;
  }
  ambGeo.setAttribute('position', new THREE.BufferAttribute(ambPos, 3));
  scene.add(new THREE.Points(ambGeo, new THREE.PointsMaterial({ color:0x1a2340, size:0.3 })));

  let t = 0;
  (function animate() {
    requestAnimationFrame(animate);
    t += 0.003;
    scene.rotation.y = t * 0.18;
    scene.rotation.x = Math.sin(t * 0.3) * 0.08;
    renderer.render(scene, camera);
  })();
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ROC CANVAS (Canvas2D)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function drawROC() {
  const canvas = document.getElementById('roc-canvas');
  const ctx    = canvas.getContext('2d');
  canvas.width  = canvas.parentElement.clientWidth * window.devicePixelRatio;
  canvas.height = 300 * window.devicePixelRatio;
  canvas.style.width  = canvas.parentElement.clientWidth + 'px';
  canvas.style.height = '300px';
  const s = window.devicePixelRatio;

  const W = canvas.width, H = canvas.height;
  const pad = { l: 48*s, r: 20*s, t: 20*s, b: 48*s };
  const gW  = W - pad.l - pad.r;
  const gH  = H - pad.t - pad.b;

  ctx.fillStyle = '#02040a';
  ctx.fillRect(0, 0, W, H);

  // Grid
  ctx.strokeStyle = '#1a2340';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 4; i++) {
    const x = pad.l + (i/4)*gW;
    const y = pad.t + (i/4)*gH;
    ctx.beginPath(); ctx.moveTo(x, pad.t); ctx.lineTo(x, pad.t+gH); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(pad.l, y); ctx.lineTo(pad.l+gW, y); ctx.stroke();
  }

  // Diagonal baseline
  ctx.setLineDash([6*s, 4*s]);
  ctx.strokeStyle = '#2a3550';
  ctx.lineWidth = 1.5;
  ctx.beginPath();
  ctx.moveTo(pad.l, pad.t+gH);
  ctx.lineTo(pad.l+gW, pad.t);
  ctx.stroke();
  ctx.setLineDash([]);

  // ROC curves (approximate from AUC values)
  const curves = [
    { label: 'E1: Logistic Regression  AUC=0.987', color: '#00e5ff', auc: 0.987 },
    { label: 'E2: Decision Tree        AUC=0.983', color: '#00ff9d', auc: 0.983 },
    { label: 'E3: LR Reduced (6 feat)  AUC=0.935', color: '#ffb800', auc: 0.935 },
  ];

  curves.forEach(({ label, color, auc }) => {
    // Parameterised convex ROC curve
    const pts = [];
    for (let i = 0; i <= 80; i++) {
      const fpr = i / 80;
      const tpr = Math.pow(fpr, 1 / (auc * 3.2));
      pts.push({ x: pad.l + fpr*gW, y: pad.t + (1-tpr)*gH });
    }
    ctx.beginPath();
    ctx.moveTo(pts[0].x, pts[0].y);
    pts.forEach(p => ctx.lineTo(p.x, p.y));
    ctx.strokeStyle = color;
    ctx.lineWidth = 2.5 * s;
    ctx.stroke();

    // Fill under curve
    ctx.lineTo(pad.l + gW, pad.t + gH);
    ctx.lineTo(pad.l, pad.t + gH);
    ctx.closePath();
    ctx.fillStyle = color + '0f';
    ctx.fill();
  });

  // Axes labels
  ctx.fillStyle = '#4a5568';
  ctx.font = `${10*s}px monospace`;
  ctx.textAlign = 'center';
  ['0.0','0.25','0.5','0.75','1.0'].forEach((v, i) => {
    ctx.fillText(v, pad.l + (i/4)*gW, pad.t + gH + 18*s);
    ctx.fillText(v, pad.l - 16*s, pad.t + (1 - i/4)*gH + 4*s);
  });
  ctx.fillStyle = '#6b7280';
  ctx.font = `${11*s}px monospace`;
  ctx.fillText('False Positive Rate', pad.l + gW/2, H - 6*s);
  ctx.save(); ctx.translate(12*s, pad.t + gH/2); ctx.rotate(-Math.PI/2);
  ctx.fillText('True Positive Rate', 0, 0); ctx.restore();

  // Legend
  curves.forEach(({ label, color }, i) => {
    const lx = pad.l + 14*s, ly = pad.t + 20*s + i * 22*s;
    ctx.fillStyle = color;
    ctx.fillRect(lx, ly, 20*s, 3*s);
    ctx.fillStyle = '#94a3b8';
    ctx.font = `${10*s}px monospace`;
    ctx.textAlign = 'left';
    ctx.fillText(label, lx + 26*s, ly + 3*s);
  });
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FEATURE IMPORTANCE 3D BAR CHART (Three.js)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let featInited = false;
function initFeatCanvas() {
  if (featInited) return; featInited = true;

  const canvas = document.getElementById('feat-canvas');
  const wrap   = document.getElementById('feat-canvas-wrap');
  const W = wrap.clientWidth, H = wrap.clientHeight;

  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
  renderer.setSize(W, H);
  renderer.shadowMap.enabled = true;

  const scene  = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(45, W/H, 0.1, 200);
  camera.position.set(0, 18, 32);
  camera.lookAt(0, 0, 0);

  // Lighting
  scene.add(new THREE.AmbientLight(0x1a2040, 4));
  const dLight = new THREE.DirectionalLight(0x00e5ff, 1.5);
  dLight.position.set(10, 20, 10);
  scene.add(dLight);

  const n = RF_IMPORTANCE.length;
  const barWidth = 1.0, gap = 0.4;
  const totalW = n * (barWidth + gap);
  const barMeshes = [];

  RF_IMPORTANCE.forEach((d, i) => {
    const barH = d.imp * 80;
    const x    = -totalW/2 + i*(barWidth+gap) + barWidth/2;
    const geo  = new THREE.BoxGeometry(barWidth, barH, barWidth);

    const c = d.imp > 0.1 ? 0xff3366 : d.imp > 0.03 ? 0xffb800 : 0x00e5ff;
    const mat = new THREE.MeshPhongMaterial({
      color: c,
      transparent: true,
      opacity: 0.85,
      emissive: c,
      emissiveIntensity: 0.12
    });
    const mesh = new THREE.Mesh(geo, mat);
    mesh.position.set(x, barH/2, 0);
    mesh.userData = { feature: d.feature, imp: d.imp, group: d.group, origY: barH/2, origH: barH };
    mesh.castShadow = true;
    barMeshes.push(mesh);
    scene.add(mesh);

    // Glow top
    const glowGeo = new THREE.PlaneGeometry(barWidth*1.2, barWidth*1.2);
    const glowMat = new THREE.MeshBasicMaterial({ color: c, transparent: true, opacity: 0.15, side: THREE.DoubleSide });
    const glow = new THREE.Mesh(glowGeo, glowMat);
    glow.rotation.x = -Math.PI/2;
    glow.position.set(x, barH + 0.05, 0);
    scene.add(glow);
  });

  // Ground grid
  const gridHelper = new THREE.GridHelper(totalW + 4, n+2, 0x1a2340, 0x0f1528);
  scene.add(gridHelper);

  // Mouse interaction
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2(-999, -999);
  const tooltip = document.getElementById('global-tooltip');
  let hovered = null;

  canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    mouse.x = ((e.clientX - rect.left) / rect.width)  * 2 - 1;
    mouse.y =-((e.clientY - rect.top)  / rect.height) * 2 + 1;

    raycaster.setFromCamera(mouse, camera);
    const hits = raycaster.intersectObjects(barMeshes);

    if (hits.length > 0) {
      const mesh = hits[0].object;
      if (hovered !== mesh) {
        if (hovered) { hovered.material.emissiveIntensity = 0.12; hovered.scale.x = 1; hovered.scale.z = 1; }
        hovered = mesh;
        mesh.material.emissiveIntensity = 0.5;
        mesh.scale.set(1.1, 1, 1.1);
      }
      const d = mesh.userData;
      const desc = FEATURE_DESC[d.feature] || 'URL-derived feature';
      tooltip.innerHTML = `<b style="color:#00e5ff">${d.feature}</b><br><span style="color:#ffb800">RF Importance: ${(d.imp*100).toFixed(1)}%</span><br><span style="color:#4a5568">${desc.replace(/\n/g,'<br>')}</span>`;
      tooltip.style.opacity = '1';
      tooltip.style.left = (e.clientX + 12) + 'px';
      tooltip.style.top  = (e.clientY - 40) + 'px';
      canvas.style.cursor = 'pointer';
    } else {
      if (hovered) { hovered.material.emissiveIntensity = 0.12; hovered.scale.set(1,1,1); hovered = null; }
      tooltip.style.opacity = '0';
      canvas.style.cursor = 'default';
    }
  });
  canvas.addEventListener('mouseleave', () => { tooltip.style.opacity = '0'; });

  let t = 0;
  (function animate() {
    requestAnimationFrame(animate);
    t += 0.008;
    camera.position.x = Math.sin(t * 0.15) * 6;
    camera.position.y = 18 + Math.sin(t * 0.1) * 2;
    camera.lookAt(0, 3, 0);
    barMeshes.forEach((m, i) => {
      const pulse = 1 + Math.sin(t + i * 0.4) * 0.015;
      if (m !== hovered) m.scale.set(1, pulse, 1);
    });
    renderer.render(scene, camera);
  })();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DECISION TREE CANVAS (Three.js)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let treeInited = false;
function initTreeCanvas() {
  if (treeInited) return; treeInited = true;

  const canvas = document.getElementById('tree-canvas');
  const wrap   = document.getElementById('tree-canvas-wrap');
  const W = wrap.clientWidth, H = wrap.clientHeight;

  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
  renderer.setSize(W, H);

  const scene  = new THREE.Scene();
  const camera = new THREE.OrthographicCamera(-W/2/40, W/2/40, H/2/40, -H/2/40, 0.1, 100);
  camera.position.z = 50;

  // Tree structure (simplified representation of actual E2 tree)
  const nodes = [
    { id:0, label:'PctExtNullSelf\nRedirectHyperlinksRT', depth:0, x:0, y:5.5, type:'split', info:'Root split. RTâ‰¤âˆ’0.5 â†’ left (suspicious)' },
    { id:1, label:'SubmitInfoToEmail',      depth:1, x:-5, y:2.8, type:'split', info:'Email form submission?' },
    { id:2, label:'PctExtHyperlinks',       depth:1, x:5,  y:2.8, type:'split', info:'External hyperlink fraction' },
    { id:3, label:'InsecureForms',          depth:2, x:-7, y:0.3, type:'split', info:'HTTP form on HTTPS page?' },
    { id:4, label:'PHISHING',               depth:2, x:-2.5,y:0.3,type:'phish', info:'TP: Submit via email â†’ likely phishing' },
    { id:5, label:'FrequentDomain\nMismatch',depth:2, x:2.5,y:0.3, type:'split', info:'Domain mismatch present?' },
    { id:6, label:'LEGIT',                  depth:2, x:7,  y:0.3, type:'legit', info:'High external links + no mismatch â†’ legitimate' },
    { id:7, label:'PHISHING',               depth:3, x:-8.5,y:-2.5,type:'phish', info:'Insecure form â†’ phishing' },
    { id:8, label:'LEGIT',                  depth:3, x:-5.5,y:-2.5,type:'legit', info:'No insecure form â†’ legitimate' },
    { id:9, label:'PHISHING',               depth:3, x:1,  y:-2.5,type:'phish', info:'Domain mismatch â†’ phishing' },
    { id:10,label:'LEGIT',                  depth:3, x:4,  y:-2.5,type:'legit', info:'No mismatch, high ext links â†’ legitimate' },
  ];

  const edges = [
    [0,1,'â‰¤ âˆ’0.5'],[0,2,'> âˆ’0.5'],
    [1,3,'= 0'],[1,4,'= 1'],
    [2,5,'= 0'],[2,6,'> 0'],
    [3,7,'= 1'],[3,8,'= 0'],
    [5,9,'= 1'],[5,10,'= 0'],
  ];

  const nodeMeshes = [];

  // Draw edges first (lines)
  edges.forEach(([a, b, lbl]) => {
    const nA = nodes[a], nB = nodes[b];
    const pts = [new THREE.Vector3(nA.x, nA.y - 0.35, 0), new THREE.Vector3(nB.x, nB.y + 0.35, 0)];
    const geo = new THREE.BufferGeometry().setFromPoints(pts);
    const mat = new THREE.LineBasicMaterial({ color: 0x1a2340, linewidth: 1 });
    scene.add(new THREE.Line(geo, mat));
  });

  // Draw nodes
  nodes.forEach(n => {
    const isLeaf  = n.type === 'phish' || n.type === 'legit';
    const w = isLeaf ? 2.0 : 3.2, h = isLeaf ? 0.7 : 0.7;
    const geo = new THREE.PlaneGeometry(w, h);
    const c = n.type === 'phish' ? 0xff3366 : n.type === 'legit' ? 0x00ff9d : 0x00e5ff;
    const mat = new THREE.MeshBasicMaterial({ color: c, transparent: true, opacity: 0.15, side: THREE.DoubleSide });
    const mesh = new THREE.Mesh(geo, mat);
    mesh.position.set(n.x, n.y, 0);
    mesh.userData = { node: n };
    nodeMeshes.push(mesh);
    scene.add(mesh);

    // Border
    const bGeo = new THREE.EdgesGeometry(geo);
    const bMat = new THREE.LineBasicMaterial({ color: c, transparent: true, opacity: 0.7 });
    const border = new THREE.LineSegments(bGeo, bMat);
    border.position.set(n.x, n.y, 0.01);
    scene.add(border);
  });

  // Raycaster for tooltip
  const raycaster = new THREE.Raycaster();
  const mouse     = new THREE.Vector2(-999,-999);
  const tooltip   = document.getElementById('tree-tooltip');

  canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    mouse.x =  ((e.clientX - rect.left) / rect.width)  * 2 - 1;
    mouse.y = -((e.clientY - rect.top)  / rect.height) * 2 + 1;
    raycaster.setFromCamera(mouse, camera);
    const hits = raycaster.intersectObjects(nodeMeshes);
    if (hits.length) {
      const nd = hits[0].object.userData.node;
      tooltip.innerHTML = `<b style="color:#00e5ff">${nd.label.replace(/\n/,'<br>')}</b><br><span style="color:#4a5568">${nd.info}</span>`;
      tooltip.style.opacity = '1';
      tooltip.style.left = (e.clientX - wrap.getBoundingClientRect().left + 10) + 'px';
      tooltip.style.top  = (e.clientY - wrap.getBoundingClientRect().top  - 40) + 'px';
    } else {
      tooltip.style.opacity = '0';
    }
  });

  // Pan with mouse drag
  let isDragging = false, lastX = 0, lastY = 0;
  canvas.addEventListener('mousedown', e => { isDragging = true; lastX = e.clientX; lastY = e.clientY; });
  canvas.addEventListener('mousemove', e => {
    if (!isDragging) return;
    const dx = (e.clientX - lastX) / 40, dy = (e.clientY - lastY) / 40;
    camera.position.x -= dx; camera.position.y += dy;
    camera.left  = camera.position.x - W/2/40;
    camera.right = camera.position.x + W/2/40;
    camera.top   = camera.position.y + H/2/40;
    camera.bottom= camera.position.y - H/2/40;
    camera.updateProjectionMatrix();
    lastX = e.clientX; lastY = e.clientY;
  });
  canvas.addEventListener('mouseup', () => { isDragging = false; });

  (function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
  })();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FEATURE IMPORTANCE LIST (DOM)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function buildFeatureList() {
  const container = document.getElementById('importance-list');
  RF_IMPORTANCE.slice(0,8).forEach((d, i) => {
    const pct = (d.imp * 100).toFixed(1);
    const c = d.imp > 0.1 ? '#ff3366' : d.imp > 0.03 ? '#ffb800' : '#00e5ff';
    container.innerHTML += `
      <div style="margin-bottom:14px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px">
          <span style="font-family:'Space Mono',monospace;font-size:10px;color:#e2e8f0">${i+1}. ${d.feature}</span>
          <span style="font-family:'Space Mono',monospace;font-size:11px;font-weight:700;color:${c}">${pct}%</span>
        </div>
        <div style="height:3px;background:#1a2340;border-radius:2px;overflow:hidden">
          <div style="height:100%;width:${(d.imp/0.23*100).toFixed(0)}%;background:${c};border-radius:2px;transition:width 1s ease"></div>
        </div>
      </div>`;
  });
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FEATURE GROUP BREAKDOWN (DOM)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function buildGroups() {
  const container = document.getElementById('group-breakdown');
  Object.entries(FEATURE_GROUPS).forEach(([name, d]) => {
    container.innerHTML += `
      <div style="display:flex;align-items:center;gap:14px">
        <div style="width:10px;height:10px;border-radius:50%;background:${d.color};flex-shrink:0"></div>
        <div style="flex:1">
          <div style="display:flex;justify-content:space-between;margin-bottom:4px">
            <span style="font-size:12px;font-weight:600">${name}</span>
            <span style="font-family:'Space Mono',monospace;font-size:10px;color:#6b7280">${d.count} features Â· ${d.pct}%</span>
          </div>
          <div style="height:3px;background:#1a2340;border-radius:2px;overflow:hidden">
            <div style="height:100%;width:${d.pct}%;background:${d.color};opacity:0.7;border-radius:2px"></div>
          </div>
        </div>
      </div>`;
  });
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// BAR ANIMATION
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function animateBars() {
  setTimeout(() => {
    document.querySelectorAll('.metric-fill').forEach(el => {
      el.style.width = el.dataset.w + '%';
    });
  }, 100);
}
animateBars();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PREDICTOR SLIDERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SLIDERS = [
  { key: 'PctExtNullSelfRedirectHyperlinksRT', label: 'Null Self-Redirect (RT)', min:-1, max:1, step:1, val:1, desc:'Rule-encoded null-redirect ratio' },
  { key: 'PctExtHyperlinks',    label: 'External Hyperlinks Fraction', min:0, max:1, step:0.01, val:0.1, desc:'Proportion of links to external domains' },
  { key: 'FrequentDomainNameMismatch', label: 'Domain Name Mismatch', min:0, max:1, step:1, val:0, desc:'Binary: display domain â‰  actual domain' },
  { key: 'NumDash',             label: 'Number of Hyphens in URL', min:0, max:15, step:1, val:0, desc:'Hyphens used to mimic brands' },
  { key: 'InsecureForms',       label: 'Insecure Form Action', min:0, max:1, step:1, val:0, desc:'HTTP form on HTTPS page' },
  { key: 'PctNullSelfRedirectHyperlinks', label: 'Null/Self-Redirect Links', min:0, max:1, step:0.01, val:0.0, desc:'Raw fraction of null redirect links' },
];

(function buildSliders() {
  const grid = document.getElementById('slider-grid');
  SLIDERS.forEach(s => {
    grid.innerHTML += `
      <div class="input-group">
        <label class="input-label">${s.label}</label>
        <div class="range-wrap">
          <input type="range" class="input-range" id="sl_${s.key}"
            min="${s.min}" max="${s.max}" step="${s.step}" value="${s.val}"
            oninput="document.getElementById('rv_${s.key}').textContent=this.value">
          <span class="range-val" id="rv_${s.key}">${s.val}</span>
        </div>
        <div style="font-family:'Space Mono',monospace;font-size:9px;color:#4a5568;margin-top:2px">${s.desc}</div>
      </div>`;
  });
})();

function runPredictor() {
  // Simplified logistic scoring using E1 coefficients (bias â‰ˆ 0)
  const vals = {};
  SLIDERS.forEach(s => { vals[s.key] = parseFloat(document.getElementById('sl_'+s.key).value); });

  // Normalize features (approximate mean/std from dataset)
  const norm = {
    'PctExtNullSelfRedirectHyperlinksRT': [0.14, 0.80],
    'PctExtHyperlinks':                   [0.38, 0.35],
    'FrequentDomainNameMismatch':          [0.10, 0.30],
    'NumDash':                             [2.4,  3.2],
    'InsecureForms':                       [0.18, 0.38],
    'PctNullSelfRedirectHyperlinks':       [0.20, 0.30],
  };

  let logit = -0.12; // approximate intercept
  SLIDERS.forEach(s => {
    const [mu, sd] = norm[s.key] || [0, 1];
    const z = (vals[s.key] - mu) / (sd || 1);
    logit += (LR_COEF[s.key] || 0) * z;
  });

  const prob = 1 / (1 + Math.exp(-logit));
  const isPhish = prob > 0.5;

  const panel = document.getElementById('result-panel');
  const verdict = document.getElementById('result-verdict');
  const conf = document.getElementById('result-conf');
  const fill = document.getElementById('prob-fill');

  verdict.textContent = isPhish ? 'âš  PHISHING' : 'âœ“ LEGITIMATE';
  verdict.className = 'result-verdict ' + (isPhish ? 'phish' : 'legit');
  conf.textContent = `Phishing probability: ${(prob*100).toFixed(1)}% | Confidence: ${(Math.abs(prob-0.5)*200).toFixed(0)}%`;
  fill.style.width = (prob*100) + '%';
  panel.classList.add('visible');

  // Signal grid
  const signals = [
    { name: 'Domain Mismatch', val: vals['FrequentDomainNameMismatch'], thresh: 0.5, dir: 'high=bad' },
    { name: 'Insecure Forms',  val: vals['InsecureForms'],              thresh: 0.5, dir: 'high=bad' },
    { name: 'Null Redirects',  val: vals['PctNullSelfRedirectHyperlinks'], thresh: 0.3, dir: 'high=bad' },
    { name: 'Ext. Links',      val: vals['PctExtHyperlinks'],            thresh: 0.4, dir: 'high=good' },
    { name: 'Hyphen Count',    val: vals['NumDash'],                     thresh: 4,   dir: 'high=bad' },
    { name: 'RT Score',        val: vals['PctExtNullSelfRedirectHyperlinksRT'], thresh: 0, dir: 'high=good' },
  ];
  const sg = document.getElementById('signal-grid');
  sg.innerHTML = signals.map(s => {
    const isBad = s.dir === 'high=bad' ? s.val > s.thresh : s.val < s.thresh;
    const cls   = isBad ? 'high' : 'low';
    return `<div class="signal-item">
      <div class="signal-name">${s.name}</div>
      <div class="signal-val ${cls}">${typeof s.val === 'number' && s.val % 1 !== 0 ? s.val.toFixed(2) : s.val}</div>
    </div>`;
  }).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INTERSECTION OBSERVER â€” animate bars on scroll into view
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const observer = new IntersectionObserver(entries => {
  entries.forEach(e => { if (e.isIntersecting) animateBars(); });
}, { threshold: 0.1 });
document.querySelectorAll('.exp-card').forEach(el => observer.observe(el));
</script>
</body>
</html>
