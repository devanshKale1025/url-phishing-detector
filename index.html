<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PhishLens â€” URL Phishing Detection Research</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap');

  :root {
    --bg:       #050810;
    --panel:    #0a0f1e;
    --border:   #1a2340;
    --accent:   #00e5ff;
    --danger:   #ff3366;
    --safe:     #00ff9d;
    --warn:     #ffb800;
    --text:     #e2e8f0;
    --muted:    #4a5568;
    --glow:     rgba(0,229,255,0.15);
    --glow2:    rgba(255,51,102,0.15);
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  html, body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    height: 100%;
    overflow-x: hidden;
  }

  /* â”€â”€ CANVAS BACKGROUND â”€â”€ */
  #bg-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
    pointer-events: none;
  }

  /* â”€â”€ LAYOUT â”€â”€ */
  #app {
    position: relative;
    z-index: 1;
    min-height: 100vh;
  }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 18px 40px;
    border-bottom: 1px solid var(--border);
    background: rgba(5,8,16,0.85);
    backdrop-filter: blur(20px);
    position: sticky; top: 0; z-index: 100;
  }

  .logo {
    display: flex; align-items: center; gap: 12px;
  }
  .logo-icon {
    width: 36px; height: 36px;
    background: linear-gradient(135deg, var(--accent), var(--danger));
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
  }
  .logo-text {
    font-size: 22px; font-weight: 800; letter-spacing: -0.5px;
  }
  .logo-text span { color: var(--accent); }

  .header-badge {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    border: 1px solid var(--border);
    padding: 4px 10px;
    border-radius: 20px;
    letter-spacing: 1px;
  }

  nav {
    display: flex; gap: 6px;
  }
  .nav-btn {
    background: none;
    border: 1px solid transparent;
    color: var(--muted);
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    padding: 6px 14px;
    border-radius: 6px;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: all 0.2s;
  }
  .nav-btn:hover, .nav-btn.active {
    color: var(--accent);
    border-color: var(--accent);
    background: var(--glow);
  }

  /* â”€â”€ SECTIONS â”€â”€ */
  section {
    display: none;
    padding: 40px;
    max-width: 1400px;
    margin: 0 auto;
    animation: fadeUp 0.4s ease;
  }
  section.active { display: block; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* â”€â”€ SECTION TITLES â”€â”€ */
  .section-title {
    font-size: 13px;
    font-family: 'Space Mono', monospace;
    color: var(--accent);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  .section-headline {
    font-size: 36px;
    font-weight: 800;
    line-height: 1.1;
    margin-bottom: 32px;
  }
  .section-headline em { color: var(--accent); font-style: normal; }

  /* â”€â”€ CARDS â”€â”€ */
  .card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 24px;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .card:hover {
    border-color: rgba(0,229,255,0.3);
    box-shadow: 0 0 30px rgba(0,229,255,0.06);
  }
  .card-title {
    font-size: 11px;
    font-family: 'Space Mono', monospace;
    color: var(--muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  /* â”€â”€ OVERVIEW HERO â”€â”€ */
  .hero-canvas-wrap {
    width: 100%;
    height: 320px;
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid var(--border);
    margin-bottom: 32px;
    position: relative;
    background: #020408;
  }
  #hero-canvas { width: 100%; height: 100%; display: block; }
  .hero-overlay {
    position: absolute; inset: 0;
    background: linear-gradient(180deg, transparent 60%, var(--bg) 100%);
    pointer-events: none;
  }
  .hero-label {
    position: absolute; bottom: 20px; left: 24px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 1px;
  }

  /* â”€â”€ STAT GRID â”€â”€ */
  .stat-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 28px;
  }
  .stat-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px 22px;
    position: relative;
    overflow: hidden;
    transition: all 0.25s;
  }
  .stat-card::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--accent);
  }
  .stat-card.danger::before { background: var(--danger); }
  .stat-card.warn::before   { background: var(--warn); }
  .stat-card.safe::before   { background: var(--safe); }
  .stat-card:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0,0,0,0.4); }
  .stat-label {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-bottom: 10px;
  }
  .stat-value {
    font-size: 32px;
    font-weight: 800;
    color: var(--accent);
    line-height: 1;
  }
  .stat-card.danger .stat-value { color: var(--danger); }
  .stat-card.warn .stat-value   { color: var(--warn); }
  .stat-card.safe .stat-value   { color: var(--safe); }
  .stat-sub {
    font-size: 11px;
    color: var(--muted);
    margin-top: 6px;
    font-family: 'Space Mono', monospace;
  }

  /* â”€â”€ EXPERIMENT CARDS â”€â”€ */
  .exp-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 32px;
  }
  .exp-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 28px;
    cursor: pointer;
    transition: all 0.25s;
    position: relative;
    overflow: hidden;
  }
  .exp-card::after {
    content: '';
    position: absolute; inset: 0;
    background: radial-gradient(circle at 50% 0%, rgba(0,229,255,0.05), transparent 60%);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .exp-card:hover::after { opacity: 1; }
  .exp-card:hover { border-color: rgba(0,229,255,0.4); transform: translateY(-3px); }
  .exp-card.e2 { border-color: rgba(0,255,157,0.2); }
  .exp-card.e2::after { background: radial-gradient(circle at 50% 0%, rgba(0,255,157,0.06), transparent 60%); }
  .exp-badge {
    display: inline-block;
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    padding: 4px 10px;
    border-radius: 20px;
    border: 1px solid var(--accent);
    color: var(--accent);
    margin-bottom: 14px;
  }
  .exp-card.e2 .exp-badge { border-color: var(--safe); color: var(--safe); }
  .exp-card.e3 .exp-badge { border-color: var(--warn); color: var(--warn); }
  .exp-name {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 6px;
  }
  .exp-desc {
    font-size: 12px;
    color: var(--muted);
    line-height: 1.6;
    margin-bottom: 20px;
    font-family: 'Space Mono', monospace;
  }
  .metric-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .metric-key {
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 1px;
  }
  .metric-val {
    font-size: 14px;
    font-weight: 700;
    color: var(--text);
  }
  .metric-bar {
    height: 3px;
    background: var(--border);
    border-radius: 2px;
    margin-bottom: 14px;
    overflow: hidden;
  }
  .metric-fill {
    height: 100%;
    border-radius: 2px;
    background: linear-gradient(90deg, var(--accent), rgba(0,229,255,0.4));
    transition: width 1s cubic-bezier(0.4,0,0.2,1);
  }
  .exp-card.e2 .metric-fill { background: linear-gradient(90deg, var(--safe), rgba(0,255,157,0.4)); }
  .exp-card.e3 .metric-fill { background: linear-gradient(90deg, var(--warn), rgba(255,184,0,0.4)); }

  /* â”€â”€ CONFUSION MATRIX â”€â”€ */
  .cm-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3px;
    max-width: 200px;
  }
  .cm-cell {
    padding: 14px 10px;
    text-align: center;
    border-radius: 6px;
    font-family: 'Space Mono', monospace;
  }
  .cm-cell .cm-num { font-size: 20px; font-weight: 700; display: block; }
  .cm-cell .cm-lbl { font-size: 9px; color: var(--muted); letter-spacing: 1px; }
  .cm-tp { background: rgba(0,255,157,0.12); color: var(--safe); }
  .cm-tn { background: rgba(0,255,157,0.12); color: var(--safe); }
  .cm-fp { background: rgba(255,184,0,0.10); color: var(--warn); }
  .cm-fn { background: rgba(255,51,102,0.12); color: var(--danger); }

  /* â”€â”€ FEATURE IMPORTANCE VIZ â”€â”€ */
  #feat-canvas-wrap {
    width: 100%;
    height: 460px;
    border-radius: 14px;
    overflow: hidden;
    border: 1px solid var(--border);
    background: #020408;
    position: relative;
  }
  #feat-canvas { width: 100%; height: 100%; display: block; }
  .feat-legend {
    position: absolute; top: 16px; right: 16px;
    display: flex; flex-direction: column; gap: 8px;
  }
  .legend-item {
    display: flex; align-items: center; gap: 8px;
    font-family: 'Space Mono', monospace;
    font-size: 10px; color: var(--muted); letter-spacing: 0.5px;
  }
  .legend-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }

  /* â”€â”€ TWO-COL LAYOUT â”€â”€ */
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .three-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }

  /* â”€â”€ ROC CANVAS â”€â”€ */
  #roc-canvas { width: 100%; height: 300px; display: block; }

  /* â”€â”€ TREE VISUALIZATION â”€â”€ */
  #tree-canvas-wrap {
    width: 100%;
    height: 500px;
    border-radius: 14px;
    overflow: hidden;
    border: 1px solid var(--border);
    background: #020408;
    position: relative;
    cursor: grab;
  }
  #tree-canvas-wrap:active { cursor: grabbing; }
  #tree-canvas { width: 100%; height: 100%; display: block; }
  .tree-tooltip {
    position: absolute;
    background: rgba(10,15,30,0.96);
    border: 1px solid var(--accent);
    border-radius: 8px;
    padding: 10px 14px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s;
    max-width: 220px;
    line-height: 1.6;
    z-index: 10;
  }

  /* â”€â”€ URL PREDICTOR â”€â”€ */
  #url-input-wrap {
    margin-bottom: 32px;
  }

  #url-box {
    display: flex;
    align-items: center;
    background: #080d1c;
    border: 1.5px solid var(--border);
    border-radius: 14px;
    padding: 6px 6px 6px 18px;
    gap: 10px;
    transition: border-color 0.25s, box-shadow 0.25s;
    position: relative;
  }
  #url-box:focus-within {
    border-color: var(--accent);
    box-shadow: 0 0 0 4px rgba(0,229,255,0.08), 0 8px 40px rgba(0,0,0,0.5);
  }
  #url-prefix {
    display: flex; align-items: center; gap: 8px;
    font-family: 'Space Mono', monospace;
    font-size: 11px; color: var(--accent);
    letter-spacing: 1px; white-space: nowrap;
    flex-shrink: 0;
    border-right: 1px solid var(--border);
    padding-right: 14px;
  }
  #url-input {
    flex: 1;
    background: none;
    border: none;
    outline: none;
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 14px;
    padding: 10px 0;
    min-width: 0;
    letter-spacing: 0.3px;
  }
  #url-input::placeholder { color: #2a3550; }

  #clear-btn {
    background: none; border: none;
    color: var(--muted); font-size: 14px;
    cursor: pointer; padding: 8px 10px;
    border-radius: 8px; line-height: 1;
    transition: color 0.15s;
    display: none;
  }
  #clear-btn:hover { color: var(--danger); }

  #analyze-btn {
    background: linear-gradient(135deg, var(--accent), #0070cc);
    color: #050810;
    font-family: 'Space Mono', monospace;
    font-size: 12px; font-weight: 700;
    letter-spacing: 1.5px;
    border: none; border-radius: 10px;
    padding: 12px 24px;
    cursor: pointer;
    display: flex; align-items: center; gap: 8px;
    flex-shrink: 0;
    transition: all 0.2s;
  }
  #analyze-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 24px rgba(0,229,255,0.3); }
  #analyze-btn.loading { opacity: 0.7; pointer-events: none; }

  #url-hint {
    margin-top: 12px;
    font-family: 'Space Mono', monospace;
    font-size: 10px; color: var(--muted);
    display: flex; align-items: center; gap: 10px;
    flex-wrap: wrap;
  }
  .hint-chip {
    background: #0d1528;
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 4px 12px;
    cursor: pointer;
    transition: all 0.15s;
    color: var(--muted);
  }
  .hint-chip:hover { border-color: var(--accent); color: var(--accent); }

  /* â”€â”€ VERDICT BANNER â”€â”€ */
  #verdict-banner {
    display: flex; align-items: center; gap: 24px;
    padding: 28px 32px;
    border-radius: 16px;
    border: 1.5px solid var(--border);
    background: #060b18;
    margin-bottom: 16px;
    position: relative;
    overflow: hidden;
    animation: fadeUp 0.35s ease;
  }
  #verdict-banner::before {
    content: '';
    position: absolute; inset: 0;
    opacity: 0;
    transition: opacity 0.4s;
    pointer-events: none;
  }
  #verdict-banner.phish { border-color: rgba(255,51,102,0.5); }
  #verdict-banner.phish::before { background: radial-gradient(ellipse at 20% 50%, rgba(255,51,102,0.07), transparent 60%); opacity:1; }
  #verdict-banner.legit { border-color: rgba(0,255,157,0.4); }
  #verdict-banner.legit::before { background: radial-gradient(ellipse at 20% 50%, rgba(0,255,157,0.06), transparent 60%); opacity:1; }

  #verdict-icon-wrap {
    flex-shrink: 0;
  }
  #verdict-icon {
    width: 64px; height: 64px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 28px;
    border: 2px solid currentColor;
  }
  #verdict-icon.phish { background: rgba(255,51,102,0.12); color: var(--danger); border-color: var(--danger); }
  #verdict-icon.legit { background: rgba(0,255,157,0.10); color: var(--safe);   border-color: var(--safe); }

  #verdict-body { flex: 1; min-width: 0; }
  #verdict-label {
    font-size: 38px; font-weight: 800; line-height: 1; margin-bottom: 8px;
  }
  #verdict-label.phish { color: var(--danger); }
  #verdict-label.legit { color: var(--safe); }
  #verdict-prob-text {
    font-family: 'Space Mono', monospace;
    font-size: 12px; color: var(--muted); margin-bottom: 8px;
  }
  #verdict-url-display {
    font-family: 'Space Mono', monospace;
    font-size: 11px; color: #3a4a70;
    overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
    max-width: 480px;
  }

  #verdict-gauge-wrap {
    flex-shrink: 0; text-align: center;
  }
  #gauge-label {
    font-family: 'Space Mono', monospace;
    font-size: 9px; color: var(--muted);
    letter-spacing: 2px; margin-top: 4px;
  }

  /* â”€â”€ PROB BAR â”€â”€ */
  #prob-track {
    display: flex; align-items: center; gap: 14px;
    margin-bottom: 28px;
  }
  #prob-bar-outer {
    flex: 1; height: 6px;
    background: var(--border);
    border-radius: 3px; overflow: visible;
    position: relative;
  }
  #prob-bar-fill {
    height: 100%; border-radius: 3px;
    background: linear-gradient(90deg, var(--safe) 0%, #ffb800 50%, var(--danger) 100%);
    transition: width 0.9s cubic-bezier(0.4,0,0.2,1);
    position: relative;
  }
  #prob-bar-marker {
    position: absolute; top: -5px;
    width: 16px; height: 16px;
    background: white; border-radius: 50%;
    border: 2px solid var(--bg);
    box-shadow: 0 0 10px rgba(255,255,255,0.4);
    transform: translateX(-50%);
    transition: left 0.9s cubic-bezier(0.4,0,0.2,1);
  }

  /* â”€â”€ FEATURE EVIDENCE GRID â”€â”€ */
  #feature-evidence-title {
    font-family: 'Space Mono', monospace;
    font-size: 10px; color: var(--muted);
    letter-spacing: 2px; margin-bottom: 14px;
  }
  #feature-evidence-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
    margin-bottom: 24px;
  }
  .feat-ev-card {
    background: #060b18;
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    transition: border-color 0.2s;
    position: relative;
    overflow: hidden;
  }
  .feat-ev-card::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0;
    height: 2px;
  }
  .feat-ev-card.bad  { border-color: rgba(255,51,102,0.3); }
  .feat-ev-card.bad::before  { background: var(--danger); }
  .feat-ev-card.warn { border-color: rgba(255,184,0,0.3); }
  .feat-ev-card.warn::before { background: var(--warn); }
  .feat-ev-card.good { border-color: rgba(0,255,157,0.2); }
  .feat-ev-card.good::before { background: var(--safe); }
  .feat-ev-name {
    font-family: 'Space Mono', monospace;
    font-size: 9px; color: var(--muted);
    letter-spacing: 0.5px; margin-bottom: 6px;
    text-transform: uppercase;
  }
  .feat-ev-val {
    font-size: 20px; font-weight: 800; line-height: 1; margin-bottom: 4px;
  }
  .feat-ev-card.bad  .feat-ev-val { color: var(--danger); }
  .feat-ev-card.warn .feat-ev-val { color: var(--warn); }
  .feat-ev-card.good .feat-ev-val { color: var(--safe); }
  .feat-ev-desc {
    font-family: 'Space Mono', monospace;
    font-size: 9px; color: #3a4a70; line-height: 1.5;
  }

  /* â”€â”€ DECISION PATH â”€â”€ */
  #decision-path-wrap {
    background: #060b18;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px 24px;
    margin-bottom: 16px;
  }
  #decision-path-title {
    font-family: 'Space Mono', monospace;
    font-size: 10px; color: var(--muted);
    letter-spacing: 2px; margin-bottom: 14px;
  }
  #decision-path {
    display: flex; flex-direction: column; gap: 8px;
  }
  .dp-step {
    display: flex; align-items: flex-start; gap: 12px;
    font-family: 'Space Mono', monospace; font-size: 11px;
    line-height: 1.6;
    animation: fadeUp 0.3s ease both;
  }
  .dp-dot {
    width: 8px; height: 8px; border-radius: 50%;
    flex-shrink: 0; margin-top: 5px;
  }
  .dp-step.bad  .dp-dot { background: var(--danger); box-shadow: 0 0 6px var(--danger); }
  .dp-step.warn .dp-dot { background: var(--warn);   box-shadow: 0 0 6px var(--warn); }
  .dp-step.good .dp-dot { background: var(--safe);   box-shadow: 0 0 6px var(--safe); }
  .dp-step.info .dp-dot { background: var(--accent);  box-shadow: 0 0 6px var(--accent); }
  .dp-text { color: var(--text); }
  .dp-text b { color: var(--accent); }

  #pred-disclaimer {
    font-family: 'Space Mono', monospace;
    font-size: 10px; color: #2a3550;
    line-height: 1.7; padding-top: 14px;
    border-top: 1px solid var(--border);
  }

  /* â”€â”€ TOOLTIP â”€â”€ */
  #global-tooltip {
    position: fixed;
    background: rgba(10,15,30,0.96);
    border: 1px solid var(--accent);
    border-radius: 8px;
    padding: 8px 12px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 9999;
    max-width: 260px;
    line-height: 1.6;
  }

  /* â”€â”€ SCROLLBAR â”€â”€ */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  /* â”€â”€ RESPONSIVE â”€â”€ */
  @media (max-width: 900px) {
    .stat-grid  { grid-template-columns: repeat(2,1fr); }
    .exp-grid   { grid-template-columns: 1fr; }
    .two-col    { grid-template-columns: 1fr; }
    .three-col  { grid-template-columns: 1fr; }
    .predictor-grid { grid-template-columns: 1fr; }
    section { padding: 20px; }
    header  { padding: 14px 20px; }
    .logo-text { font-size: 18px; }
  }
</style>
</head>
<body>

<canvas id="bg-canvas"></canvas>

<div id="app">

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-icon">ðŸ›¡</div>
    <div class="logo-text">Phish<span>Lens</span></div>
  </div>
  <nav>
    <button class="nav-btn active" onclick="showSection('overview')">OVERVIEW</button>
    <button class="nav-btn" onclick="showSection('experiments')">EXPERIMENTS</button>
    <button class="nav-btn" onclick="showSection('features')">FEATURES</button>
    <button class="nav-btn" onclick="showSection('tree')">TREE</button>
    <button class="nav-btn" onclick="showSection('predictor')">PREDICTOR</button>
  </nav>
  <div class="header-badge">10,000 SAMPLES Â· 48 FEATURES Â· 3 MODELS</div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: OVERVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="overview" class="active">
  <div class="section-title">Research Dashboard</div>
  <div class="section-headline">Phishing Detection via<br><em>Interpretable URL Features</em></div>

  <!-- 3D Hero canvas -->
  <div class="hero-canvas-wrap">
    <canvas id="hero-canvas"></canvas>
    <div class="hero-overlay"></div>
    <div class="hero-label">LIVE 3D Â· URL FEATURE SPACE Â· PHISHING vs LEGITIMATE</div>
  </div>

  <!-- Stats -->
  <div class="stat-grid">
    <div class="stat-card safe">
      <div class="stat-label">Best Accuracy</div>
      <div class="stat-value">96.25%</div>
      <div class="stat-sub">Decision Tree Â· E2</div>
    </div>
    <div class="stat-card safe">
      <div class="stat-label">Best F1-Score</div>
      <div class="stat-value">0.9624</div>
      <div class="stat-sub">Decision Tree Â· E2</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">ROC-AUC (E1)</div>
      <div class="stat-value">0.9869</div>
      <div class="stat-sub">Logistic Regression</div>
    </div>
    <div class="stat-card warn">
      <div class="stat-label">Min FPR</div>
      <div class="stat-value">3.6%</div>
      <div class="stat-sub">Legit sites blocked Â· E2</div>
    </div>
  </div>

  <!-- ROC + confusion -->
  <div class="two-col">
    <div class="card">
      <div class="card-title">ROC Curves â€” All Experiments</div>
      <canvas id="roc-canvas"></canvas>
    </div>
    <div class="card">
      <div class="card-title">Constraint Acknowledgments</div>
      <div style="display:flex; flex-direction:column; gap:12px; margin-top:8px;">
        <div class="constraint-item" style="display:flex;gap:14px;align-items:flex-start">
          <span style="color:var(--accent);font-size:18px;margin-top:2px">â—‹</span>
          <div>
            <div style="font-size:13px;font-weight:600;margin-bottom:3px">No Raw URL Parsing</div>
            <div style="font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;line-height:1.6">All 48 features are pre-computed numeric values. Original URLs not present in dataset.</div>
          </div>
        </div>
        <div class="constraint-item" style="display:flex;gap:14px;align-items:flex-start">
          <span style="color:var(--accent);font-size:18px;margin-top:2px">â—‹</span>
          <div>
            <div style="font-size:13px;font-weight:600;margin-bottom:3px">No Live Website Analysis</div>
            <div style="font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;line-height:1.6">No JavaScript execution, redirect following, or external service calls.</div>
          </div>
        </div>
        <div class="constraint-item" style="display:flex;gap:14px;align-items:flex-start">
          <span style="color:var(--accent);font-size:18px;margin-top:2px">â—‹</span>
          <div>
            <div style="font-size:13px;font-weight:600;margin-bottom:3px">Interpretable Models Only</div>
            <div style="font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;line-height:1.6">Logistic Regression Â· Decision Tree (depthâ‰¤5) Â· Shallow Random Forest. No neural nets or boosting.</div>
          </div>
        </div>
        <div class="constraint-item" style="display:flex;gap:14px;align-items:flex-start">
          <span style="color:var(--accent);font-size:18px;margin-top:2px">â—‹</span>
          <div>
            <div style="font-size:13px;font-weight:600;margin-bottom:3px">Balanced Dataset</div>
            <div style="font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;line-height:1.6">5,000 phishing + 5,000 legitimate. 80/20 stratified split. Seed = 42.</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: EXPERIMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="experiments">
  <div class="section-title">Experimental Results</div>
  <div class="section-headline">Three Controlled<br><em>Experiments</em></div>

  <div class="exp-grid">
    <!-- E1 -->
    <div class="exp-card e1">
      <div class="exp-badge">E1</div>
      <div class="exp-name">Logistic Regression</div>
      <div class="exp-desc">48 features Â· StandardScaler Â· L2 reg C=1.0 Â· lbfgs solver</div>
      <div class="metric-row"><span class="metric-key">ACCURACY</span><span class="metric-val">95.20%</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%" data-w="95.2"></div></div>
      <div class="metric-row"><span class="metric-key">F1-SCORE</span><span class="metric-val">0.9524</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%" data-w="95.24"></div></div>
      <div class="metric-row"><span class="metric-key">ROC-AUC</span><span class="metric-val">0.9869</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%" data-w="98.69"></div></div>
      <div class="metric-row"><span class="metric-key">CV F1 (5-fold)</span><span class="metric-val">0.9411 Â± 0.0037</span></div>
      <hr style="border:none;border-top:1px solid var(--border);margin:16px 0">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="metric-key" style="margin-bottom:6px">CONFUSION MATRIX</div>
          <div class="cm-grid">
            <div class="cm-cell cm-tn"><span class="cm-num">944</span><span class="cm-lbl">TN</span></div>
            <div class="cm-cell cm-fp"><span class="cm-num">56</span><span class="cm-lbl">FP</span></div>
            <div class="cm-cell cm-fn"><span class="cm-num">40</span><span class="cm-lbl">FN</span></div>
            <div class="cm-cell cm-tp"><span class="cm-num">960</span><span class="cm-lbl">TP</span></div>
          </div>
        </div>
        <div style="text-align:right">
          <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:4px">FPR</div>
          <div style="font-size:22px;font-weight:800;color:var(--warn)">5.6%</div>
          <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-top:10px;margin-bottom:4px">FNR</div>
          <div style="font-size:22px;font-weight:800;color:var(--danger)">4.0%</div>
        </div>
      </div>
    </div>

    <!-- E2 -->
    <div class="exp-card e2" style="border-color:rgba(0,255,157,0.25)">
      <div class="exp-badge" style="border-color:var(--safe);color:var(--safe)">E2 Â· BEST</div>
      <div class="exp-name">Decision Tree</div>
      <div class="exp-desc">depthâ‰¤5 Â· Gini Â· min_leaf=20 Â· fully interpretable path rules</div>
      <div class="metric-row"><span class="metric-key">ACCURACY</span><span class="metric-val" style="color:var(--safe)">96.25%</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%;background:linear-gradient(90deg,var(--safe),rgba(0,255,157,0.3))" data-w="96.25"></div></div>
      <div class="metric-row"><span class="metric-key">F1-SCORE</span><span class="metric-val" style="color:var(--safe)">0.9624</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%;background:linear-gradient(90deg,var(--safe),rgba(0,255,157,0.3))" data-w="96.24"></div></div>
      <div class="metric-row"><span class="metric-key">ROC-AUC</span><span class="metric-val">0.9830</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%;background:linear-gradient(90deg,var(--safe),rgba(0,255,157,0.3))" data-w="98.30"></div></div>
      <div class="metric-row"><span class="metric-key">CV F1 (5-fold)</span><span class="metric-val">0.9539 Â± 0.0078</span></div>
      <hr style="border:none;border-top:1px solid var(--border);margin:16px 0">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="metric-key" style="margin-bottom:6px">CONFUSION MATRIX</div>
          <div class="cm-grid">
            <div class="cm-cell cm-tn"><span class="cm-num">964</span><span class="cm-lbl">TN</span></div>
            <div class="cm-cell cm-fp"><span class="cm-num">36</span><span class="cm-lbl">FP</span></div>
            <div class="cm-cell cm-fn"><span class="cm-num">39</span><span class="cm-lbl">FN</span></div>
            <div class="cm-cell cm-tp"><span class="cm-num">961</span><span class="cm-lbl">TP</span></div>
          </div>
        </div>
        <div style="text-align:right">
          <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:4px">FPR</div>
          <div style="font-size:22px;font-weight:800;color:var(--safe)">3.6%</div>
          <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-top:10px;margin-bottom:4px">FNR</div>
          <div style="font-size:22px;font-weight:800;color:var(--safe)">3.9%</div>
        </div>
      </div>
    </div>

    <!-- E3 -->
    <div class="exp-card e3">
      <div class="exp-badge" style="border-color:var(--warn);color:var(--warn)">E3 Â· REDUCED</div>
      <div class="exp-name">LR Reduced</div>
      <div class="exp-desc">Top 6 features by RF importance Â· measures cost of feature reduction</div>
      <div class="metric-row"><span class="metric-key">ACCURACY</span><span class="metric-val" style="color:var(--warn)">87.00%</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%;background:linear-gradient(90deg,var(--warn),rgba(255,184,0,0.3))" data-w="87.0"></div></div>
      <div class="metric-row"><span class="metric-key">F1-SCORE</span><span class="metric-val" style="color:var(--warn)">0.8713</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%;background:linear-gradient(90deg,var(--warn),rgba(255,184,0,0.3))" data-w="87.13"></div></div>
      <div class="metric-row"><span class="metric-key">ROC-AUC</span><span class="metric-val">0.9352</span></div>
      <div class="metric-bar"><div class="metric-fill" style="width:0%;background:linear-gradient(90deg,var(--warn),rgba(255,184,0,0.3))" data-w="93.52"></div></div>
      <div class="metric-row"><span class="metric-key">CV F1 (5-fold)</span><span class="metric-val">0.8691 Â± 0.0045</span></div>
      <hr style="border:none;border-top:1px solid var(--border);margin:16px 0">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="metric-key" style="margin-bottom:6px">CONFUSION MATRIX</div>
          <div class="cm-grid">
            <div class="cm-cell cm-tn"><span class="cm-num">860</span><span class="cm-lbl">TN</span></div>
            <div class="cm-cell cm-fp"><span class="cm-num">140</span><span class="cm-lbl">FP</span></div>
            <div class="cm-cell cm-fn"><span class="cm-num">120</span><span class="cm-lbl">FN</span></div>
            <div class="cm-cell cm-tp"><span class="cm-num">880</span><span class="cm-lbl">TP</span></div>
          </div>
        </div>
        <div style="text-align:right">
          <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:4px">FPR</div>
          <div style="font-size:22px;font-weight:800;color:var(--danger)">14.0%</div>
          <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-top:10px;margin-bottom:4px">FNR</div>
          <div style="font-size:22px;font-weight:800;color:var(--danger)">12.0%</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Delta analysis -->
  <div class="card" style="margin-top:4px">
    <div class="card-title">E3 vs E1 â€” Cost of Feature Reduction (42 features removed)</div>
    <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:20px;margin-top:12px">
      <div>
        <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:6px">Î”Accuracy</div>
        <div style="font-size:26px;font-weight:800;color:var(--danger)">âˆ’8.20pp</div>
      </div>
      <div>
        <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:6px">Î”F1-Score</div>
        <div style="font-size:26px;font-weight:800;color:var(--danger)">âˆ’0.0811</div>
      </div>
      <div>
        <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:6px">Î”FPR</div>
        <div style="font-size:26px;font-weight:800;color:var(--danger)">+8.40pp</div>
      </div>
      <div>
        <div style="font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:6px">Interpretation</div>
        <div style="font-size:12px;color:var(--muted);font-family:'Space Mono',monospace;line-height:1.6;margin-top:4px">Signal is distributed. No single 6-feature subset captures all attack patterns.</div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: FEATURES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="features">
  <div class="section-title">Feature Analysis</div>
  <div class="section-headline">48 Handcrafted<br><em>URL Features</em></div>

  <div id="feat-canvas-wrap">
    <canvas id="feat-canvas"></canvas>
    <div class="feat-legend">
      <div class="legend-item"><div class="legend-dot" style="background:#ff3366"></div>HIGH IMPORTANCE (>10%)</div>
      <div class="legend-item"><div class="legend-dot" style="background:#ffb800"></div>MEDIUM (3â€“10%)</div>
      <div class="legend-item"><div class="legend-dot" style="background:#00e5ff"></div>LOW (<3%)</div>
      <div class="legend-item"><div class="legend-dot" style="background:rgba(255,255,255,0.15)"></div>HOVER FOR DETAILS</div>
    </div>
  </div>

  <div style="margin-top:24px" class="two-col">
    <div class="card">
      <div class="card-title">Top 8 Features by RF Importance</div>
      <div id="importance-list" style="margin-top:8px"></div>
    </div>
    <div class="card">
      <div class="card-title">Feature Groups</div>
      <div style="display:flex;flex-direction:column;gap:14px;margin-top:8px" id="group-breakdown"></div>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: TREE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="tree">
  <div class="section-title">Decision Tree Â· E2</div>
  <div class="section-headline">Interpretable<br><em>Decision Paths</em></div>

  <div id="tree-canvas-wrap">
    <canvas id="tree-canvas"></canvas>
    <div class="tree-tooltip" id="tree-tooltip"></div>
  </div>

  <div style="margin-top:20px" class="three-col">
    <div class="card">
      <div class="card-title">Root Split</div>
      <div style="font-size:13px;font-weight:600;color:var(--accent);margin-bottom:6px">PctExtNullSelfRedirectHyperlinksRT</div>
      <div style="font-size:11px;color:var(--muted);font-family:'Space Mono',monospace;line-height:1.7">Rule-encoded fraction of null/self-redirect links. Phishing pages use decorative non-functional links to mimic legitimate site layouts.</div>
    </div>
    <div class="card">
      <div class="card-title">Secondary Splits</div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div style="font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--accent)">PctExtHyperlinks</span><br>
          <span style="color:var(--muted)">High external links = legitimate (content-rich pages link to sources)</span>
        </div>
        <div style="font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--accent)">InsecureForms</span><br>
          <span style="color:var(--muted)">HTTP form on HTTPS page = credential theft mechanic</span>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-title">Tree Constraints</div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div style="display:flex;justify-content:space-between;font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--muted)">max_depth</span><span style="color:var(--text)">5</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--muted)">criterion</span><span style="color:var(--text)">gini</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--muted)">min_samples_leaf</span><span style="color:var(--text)">20</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--muted)">max_leaves</span><span style="color:var(--text)">â‰¤32</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-family:'Space Mono',monospace;font-size:11px">
          <span style="color:var(--muted)">human-auditable</span><span style="color:var(--safe)">YES</span>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION: PREDICTOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="predictor">
  <div class="section-title">Interactive Demo</div>
  <div class="section-headline">Paste Any URL.<br><em>Instant Verdict.</em></div>
  <div style="font-family:'Space Mono',monospace;font-size:11px;color:var(--muted);margin-bottom:36px;line-height:1.9">
    URL features are extracted client-side in real time â€” no server, no network request.<br>
    Model uses 20 lexical &amp; structural features derived directly from the URL string.
  </div>

  <!-- URL INPUT BOX -->
  <div id="url-input-wrap">
    <div id="url-box">
      <div id="url-prefix">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07L11.5 5.5"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07L12.5 18.5"/></svg>
        URL
      </div>
      <input
        type="text"
        id="url-input"
        placeholder="https://example.com/path?query=value"
        autocomplete="off" autocorrect="off" spellcheck="false"
        oninput="onURLInput(this.value)"
        onkeydown="if(event.key==='Enter') analyzeURL()"
      />
      <button id="clear-btn" onclick="clearURL()" title="Clear">âœ•</button>
      <button id="analyze-btn" onclick="analyzeURL()">
        <span id="btn-icon">âš¡</span>
        <span id="btn-text">ANALYZE</span>
      </button>
    </div>
    <div id="url-hint">Try: <span class="hint-chip" onclick="pasteExample('https://paypal-secure-login.account-verify.com/update?user=admin&session=xyz123')">phishing example</span> <span class="hint-chip" onclick="pasteExample('https://www.github.com/features/copilot')">legit example</span> <span class="hint-chip" onclick="pasteExample('http://192.168.1.1/admin/login.php?redirect=http://evil.ru')">IP-based attack</span></div>
  </div>

  <!-- RESULTS AREA â€” hidden until analysis runs -->
  <div id="pred-results" style="display:none">

    <!-- Verdict banner -->
    <div id="verdict-banner">
      <div id="verdict-icon-wrap">
        <div id="verdict-icon"></div>
      </div>
      <div id="verdict-body">
        <div id="verdict-label"></div>
        <div id="verdict-prob-text"></div>
        <div id="verdict-url-display"></div>
      </div>
      <div id="verdict-gauge-wrap">
        <canvas id="gauge-canvas" width="140" height="140"></canvas>
        <div id="gauge-label">PHISH SCORE</div>
      </div>
    </div>

    <!-- Probability bar -->
    <div id="prob-track">
      <span style="color:var(--safe);font-family:'Space Mono',monospace;font-size:10px;letter-spacing:1px">LEGITIMATE</span>
      <div id="prob-bar-outer"><div id="prob-bar-fill"></div><div id="prob-bar-marker"></div></div>
      <span style="color:var(--danger);font-family:'Space Mono',monospace;font-size:10px;letter-spacing:1px">PHISHING</span>
    </div>

    <!-- Feature grid -->
    <div id="feature-evidence-title">EXTRACTED FEATURES &amp; EVIDENCE</div>
    <div id="feature-evidence-grid"></div>

    <!-- Decision path -->
    <div id="decision-path-wrap">
      <div id="decision-path-title">DECISION TRACE â€” WHY THIS VERDICT?</div>
      <div id="decision-path"></div>
    </div>

    <div id="pred-disclaimer">
      âš  Client-side feature extraction covers URL structure only. Page content, form behavior, and RT features require full server-side analysis. This is an educational demonstration of the research model's logic.
    </div>
  </div>
</section>

</div><!-- /app -->

<div id="global-tooltip"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RF_IMPORTANCE = [
  { feature: 'PctExtNullSelfRedirectHyperlinksRT', imp: 0.2225, group: 'RT' },
  { feature: 'PctExtHyperlinks',                   imp: 0.2007, group: 'Security' },
  { feature: 'PctExtResourceUrls',                  imp: 0.0944, group: 'Security' },
  { feature: 'FrequentDomainNameMismatch',           imp: 0.0919, group: 'Domain' },
  { feature: 'PctNullSelfRedirectHyperlinks',        imp: 0.0635, group: 'Security' },
  { feature: 'NumDash',                              imp: 0.0508, group: 'SuspChar' },
  { feature: 'ExtMetaScriptLinkRT',                  imp: 0.0393, group: 'RT' },
  { feature: 'InsecureForms',                        imp: 0.0309, group: 'Security' },
  { feature: 'NumNumericChars',                      imp: 0.0256, group: 'SuspChar' },
  { feature: 'SubmitInfoToEmail',                    imp: 0.0225, group: 'Security' },
  { feature: 'PathLevel',                            imp: 0.0201, group: 'URLLen' },
  { feature: 'NumQueryComponents',                   imp: 0.0163, group: 'SuspChar' },
  { feature: 'NumDots',                              imp: 0.0144, group: 'URLLen' },
  { feature: 'QueryLength',                          imp: 0.0138, group: 'URLLen' },
];

const LR_COEF = {
  'PctExtNullSelfRedirectHyperlinksRT': -3.407,
  'PctExtHyperlinks': -2.213,
  'PctExtResourceUrls': -0.978,
  'FrequentDomainNameMismatch': 2.071,
  'PctNullSelfRedirectHyperlinks': -1.176,
  'NumDash': -1.608,
};

const FEATURE_GROUPS = {
  'URL Length & Structure':    { count:7,  pct:14.6, color:'#4e79a7' },
  'Suspicious Characters':     { count:11, pct:18.2, color:'#f28e2b' },
  'Domain & Identity':         { count:8,  pct:21.3, color:'#e15759' },
  'Security Behaviors':        { count:16, pct:33.1, color:'#76b7b2' },
  'Rule-Based (RT)':           { count:6,  pct:12.8, color:'#59a14f' },
};

const FEATURE_DESC = {
  'PctExtNullSelfRedirectHyperlinksRT': 'RT-encoded fraction of null/self-redirect hyperlinks.\nHigh value on phishing pages â€” decorative non-functional links.',
  'PctExtHyperlinks':  'Fraction of hyperlinks pointing to external domains.\nCounterintuitively higher on legit (content-rich) pages.',
  'PctExtResourceUrls': 'Fraction of script/image resources from external domains.',
  'FrequentDomainNameMismatch': 'Binary: mismatch between displayed and actual domain.\nDirect deception signal.',
  'PctNullSelfRedirectHyperlinks': 'Fraction of null or self-redirect links (raw, not RT-encoded).',
  'NumDash': 'Count of hyphen characters in full URL.\nUsed to mimic brands: paypal-secure-login.com',
  'ExtMetaScriptLinkRT': 'RT-encoded ratio of external meta/script/link elements.',
  'InsecureForms': 'Binary: HTTP form action on an HTTPS page.\nDirect credential-theft indicator.',
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// NAV
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showSection(id) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  event.target.classList.add('active');
  if (id === 'features') initFeatCanvas();
  if (id === 'tree')     initTreeCanvas();
  animateBars();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// BACKGROUND CANVAS (THREE.JS)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function initBG() {
  const canvas = document.getElementById('bg-canvas');
  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
  renderer.setSize(window.innerWidth, window.innerHeight);

  const scene  = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.z = 60;

  // Particle grid
  const count = 800;
  const geo   = new THREE.BufferGeometry();
  const pos   = new Float32Array(count * 3);
  const colors = new Float32Array(count * 3);
  for (let i = 0; i < count; i++) {
    pos[i*3]   = (Math.random()-0.5)*200;
    pos[i*3+1] = (Math.random()-0.5)*200;
    pos[i*3+2] = (Math.random()-0.5)*100;
    const t = Math.random();
    colors[i*3]   = t < 0.5 ? 0.0  : 1.0;
    colors[i*3+1] = t < 0.5 ? 0.9  : 0.2;
    colors[i*3+2] = t < 0.5 ? 1.0  : 0.4;
  }
  geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
  geo.setAttribute('color',    new THREE.BufferAttribute(colors, 3));
  const mat = new THREE.PointsMaterial({ size: 0.6, vertexColors: true, transparent: true, opacity: 0.25 });
  scene.add(new THREE.Points(geo, mat));

  // Connecting lines (sparse)
  const lineGeo = new THREE.BufferGeometry();
  const linePos = [];
  for (let i = 0; i < 60; i++) {
    const a = Math.floor(Math.random()*count)*3;
    const b = Math.floor(Math.random()*count)*3;
    linePos.push(pos[a],pos[a+1],pos[a+2], pos[b],pos[b+1],pos[b+2]);
  }
  lineGeo.setAttribute('position', new THREE.BufferAttribute(new Float32Array(linePos), 3));
  const lineMat = new THREE.LineBasicMaterial({ color: 0x1a2340, transparent: true, opacity: 0.4 });
  scene.add(new THREE.LineSegments(lineGeo, lineMat));

  let t = 0;
  (function animate() {
    requestAnimationFrame(animate);
    t += 0.0004;
    scene.rotation.y = t * 0.3;
    scene.rotation.x = Math.sin(t) * 0.05;
    renderer.render(scene, camera);
  })();

  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HERO CANVAS â€” 3D SCATTER PLOT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function initHero() {
  const canvas = document.getElementById('hero-canvas');
  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));

  const w = canvas.parentElement.clientWidth;
  const h = canvas.parentElement.clientHeight;
  renderer.setSize(w, h);

  const scene  = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(55, w / h, 0.1, 500);
  camera.position.set(0, 0, 40);

  // Generate clustered scatter: phishing vs legit
  const N = 400;
  const geoP = new THREE.BufferGeometry();
  const geoL = new THREE.BufferGeometry();
  const posP = new Float32Array(N*3), posL = new Float32Array(N*3);

  for (let i = 0; i < N; i++) {
    // Phishing cluster
    posP[i*3]   = (Math.random()-0.5)*18 + 6;
    posP[i*3+1] = (Math.random()-0.5)*14 + 2;
    posP[i*3+2] = (Math.random()-0.5)*14;
    // Legit cluster
    posL[i*3]   = (Math.random()-0.5)*18 - 6;
    posL[i*3+1] = (Math.random()-0.5)*14 - 2;
    posL[i*3+2] = (Math.random()-0.5)*14;
  }
  geoP.setAttribute('position', new THREE.BufferAttribute(posP, 3));
  geoL.setAttribute('position', new THREE.BufferAttribute(posL, 3));

  const matP = new THREE.PointsMaterial({ color: 0xff3366, size: 0.4, transparent: true, opacity: 0.7 });
  const matL = new THREE.PointsMaterial({ color: 0x00ff9d, size: 0.4, transparent: true, opacity: 0.7 });
  const ptP = new THREE.Points(geoP, matP);
  const ptL = new THREE.Points(geoL, matL);

  // Decision boundary plane
  const planeGeo = new THREE.PlaneGeometry(30, 24);
  const planeMat = new THREE.MeshBasicMaterial({
    color: 0x00e5ff, transparent: true, opacity: 0.04,
    side: THREE.DoubleSide, wireframe: false
  });
  const planeWireMat = new THREE.MeshBasicMaterial({
    color: 0x00e5ff, transparent: true, opacity: 0.12,
    side: THREE.DoubleSide, wireframe: true
  });
  const plane = new THREE.Mesh(planeGeo, planeMat);
  const planeWire = new THREE.Mesh(planeGeo, planeWireMat);
  plane.rotation.y = 0.3; planeWire.rotation.y = 0.3;

  scene.add(ptP, ptL, plane, planeWire);

  // Ambient particles
  const ambGeo = new THREE.BufferGeometry();
  const ambPos = new Float32Array(200*3);
  for (let i=0;i<200;i++) {
    ambPos[i*3]   = (Math.random()-0.5)*60;
    ambPos[i*3+1] = (Math.random()-0.5)*40;
    ambPos[i*3+2] = (Math.random()-0.5)*40;
  }
  ambGeo.setAttribute('position', new THREE.BufferAttribute(ambPos, 3));
  scene.add(new THREE.Points(ambGeo, new THREE.PointsMaterial({ color:0x1a2340, size:0.3 })));

  let t = 0;
  (function animate() {
    requestAnimationFrame(animate);
    t += 0.003;
    scene.rotation.y = t * 0.18;
    scene.rotation.x = Math.sin(t * 0.3) * 0.08;
    renderer.render(scene, camera);
  })();
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ROC CANVAS (Canvas2D)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function drawROC() {
  const canvas = document.getElementById('roc-canvas');
  const ctx    = canvas.getContext('2d');
  canvas.width  = canvas.parentElement.clientWidth * window.devicePixelRatio;
  canvas.height = 300 * window.devicePixelRatio;
  canvas.style.width  = canvas.parentElement.clientWidth + 'px';
  canvas.style.height = '300px';
  const s = window.devicePixelRatio;

  const W = canvas.width, H = canvas.height;
  const pad = { l: 48*s, r: 20*s, t: 20*s, b: 48*s };
  const gW  = W - pad.l - pad.r;
  const gH  = H - pad.t - pad.b;

  ctx.fillStyle = '#02040a';
  ctx.fillRect(0, 0, W, H);

  // Grid
  ctx.strokeStyle = '#1a2340';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 4; i++) {
    const x = pad.l + (i/4)*gW;
    const y = pad.t + (i/4)*gH;
    ctx.beginPath(); ctx.moveTo(x, pad.t); ctx.lineTo(x, pad.t+gH); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(pad.l, y); ctx.lineTo(pad.l+gW, y); ctx.stroke();
  }

  // Diagonal baseline
  ctx.setLineDash([6*s, 4*s]);
  ctx.strokeStyle = '#2a3550';
  ctx.lineWidth = 1.5;
  ctx.beginPath();
  ctx.moveTo(pad.l, pad.t+gH);
  ctx.lineTo(pad.l+gW, pad.t);
  ctx.stroke();
  ctx.setLineDash([]);

  // ROC curves (approximate from AUC values)
  const curves = [
    { label: 'E1: Logistic Regression  AUC=0.987', color: '#00e5ff', auc: 0.987 },
    { label: 'E2: Decision Tree        AUC=0.983', color: '#00ff9d', auc: 0.983 },
    { label: 'E3: LR Reduced (6 feat)  AUC=0.935', color: '#ffb800', auc: 0.935 },
  ];

  curves.forEach(({ label, color, auc }) => {
    // Parameterised convex ROC curve
    const pts = [];
    for (let i = 0; i <= 80; i++) {
      const fpr = i / 80;
      const tpr = Math.pow(fpr, 1 / (auc * 3.2));
      pts.push({ x: pad.l + fpr*gW, y: pad.t + (1-tpr)*gH });
    }
    ctx.beginPath();
    ctx.moveTo(pts[0].x, pts[0].y);
    pts.forEach(p => ctx.lineTo(p.x, p.y));
    ctx.strokeStyle = color;
    ctx.lineWidth = 2.5 * s;
    ctx.stroke();

    // Fill under curve
    ctx.lineTo(pad.l + gW, pad.t + gH);
    ctx.lineTo(pad.l, pad.t + gH);
    ctx.closePath();
    ctx.fillStyle = color + '0f';
    ctx.fill();
  });

  // Axes labels
  ctx.fillStyle = '#4a5568';
  ctx.font = `${10*s}px monospace`;
  ctx.textAlign = 'center';
  ['0.0','0.25','0.5','0.75','1.0'].forEach((v, i) => {
    ctx.fillText(v, pad.l + (i/4)*gW, pad.t + gH + 18*s);
    ctx.fillText(v, pad.l - 16*s, pad.t + (1 - i/4)*gH + 4*s);
  });
  ctx.fillStyle = '#6b7280';
  ctx.font = `${11*s}px monospace`;
  ctx.fillText('False Positive Rate', pad.l + gW/2, H - 6*s);
  ctx.save(); ctx.translate(12*s, pad.t + gH/2); ctx.rotate(-Math.PI/2);
  ctx.fillText('True Positive Rate', 0, 0); ctx.restore();

  // Legend
  curves.forEach(({ label, color }, i) => {
    const lx = pad.l + 14*s, ly = pad.t + 20*s + i * 22*s;
    ctx.fillStyle = color;
    ctx.fillRect(lx, ly, 20*s, 3*s);
    ctx.fillStyle = '#94a3b8';
    ctx.font = `${10*s}px monospace`;
    ctx.textAlign = 'left';
    ctx.fillText(label, lx + 26*s, ly + 3*s);
  });
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FEATURE IMPORTANCE 3D BAR CHART (Three.js)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let featInited = false;
function initFeatCanvas() {
  if (featInited) return; featInited = true;

  const canvas = document.getElementById('feat-canvas');
  const wrap   = document.getElementById('feat-canvas-wrap');
  const W = wrap.clientWidth, H = wrap.clientHeight;

  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
  renderer.setSize(W, H);
  renderer.shadowMap.enabled = true;

  const scene  = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(45, W/H, 0.1, 200);
  camera.position.set(0, 18, 32);
  camera.lookAt(0, 0, 0);

  // Lighting
  scene.add(new THREE.AmbientLight(0x1a2040, 4));
  const dLight = new THREE.DirectionalLight(0x00e5ff, 1.5);
  dLight.position.set(10, 20, 10);
  scene.add(dLight);

  const n = RF_IMPORTANCE.length;
  const barWidth = 1.0, gap = 0.4;
  const totalW = n * (barWidth + gap);
  const barMeshes = [];

  RF_IMPORTANCE.forEach((d, i) => {
    const barH = d.imp * 80;
    const x    = -totalW/2 + i*(barWidth+gap) + barWidth/2;
    const geo  = new THREE.BoxGeometry(barWidth, barH, barWidth);

    const c = d.imp > 0.1 ? 0xff3366 : d.imp > 0.03 ? 0xffb800 : 0x00e5ff;
    const mat = new THREE.MeshPhongMaterial({
      color: c,
      transparent: true,
      opacity: 0.85,
      emissive: c,
      emissiveIntensity: 0.12
    });
    const mesh = new THREE.Mesh(geo, mat);
    mesh.position.set(x, barH/2, 0);
    mesh.userData = { feature: d.feature, imp: d.imp, group: d.group, origY: barH/2, origH: barH };
    mesh.castShadow = true;
    barMeshes.push(mesh);
    scene.add(mesh);

    // Glow top
    const glowGeo = new THREE.PlaneGeometry(barWidth*1.2, barWidth*1.2);
    const glowMat = new THREE.MeshBasicMaterial({ color: c, transparent: true, opacity: 0.15, side: THREE.DoubleSide });
    const glow = new THREE.Mesh(glowGeo, glowMat);
    glow.rotation.x = -Math.PI/2;
    glow.position.set(x, barH + 0.05, 0);
    scene.add(glow);
  });

  // Ground grid
  const gridHelper = new THREE.GridHelper(totalW + 4, n+2, 0x1a2340, 0x0f1528);
  scene.add(gridHelper);

  // Mouse interaction
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2(-999, -999);
  const tooltip = document.getElementById('global-tooltip');
  let hovered = null;

  canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    mouse.x = ((e.clientX - rect.left) / rect.width)  * 2 - 1;
    mouse.y =-((e.clientY - rect.top)  / rect.height) * 2 + 1;

    raycaster.setFromCamera(mouse, camera);
    const hits = raycaster.intersectObjects(barMeshes);

    if (hits.length > 0) {
      const mesh = hits[0].object;
      if (hovered !== mesh) {
        if (hovered) { hovered.material.emissiveIntensity = 0.12; hovered.scale.x = 1; hovered.scale.z = 1; }
        hovered = mesh;
        mesh.material.emissiveIntensity = 0.5;
        mesh.scale.set(1.1, 1, 1.1);
      }
      const d = mesh.userData;
      const desc = FEATURE_DESC[d.feature] || 'URL-derived feature';
      tooltip.innerHTML = `<b style="color:#00e5ff">${d.feature}</b><br><span style="color:#ffb800">RF Importance: ${(d.imp*100).toFixed(1)}%</span><br><span style="color:#4a5568">${desc.replace(/\n/g,'<br>')}</span>`;
      tooltip.style.opacity = '1';
      tooltip.style.left = (e.clientX + 12) + 'px';
      tooltip.style.top  = (e.clientY - 40) + 'px';
      canvas.style.cursor = 'pointer';
    } else {
      if (hovered) { hovered.material.emissiveIntensity = 0.12; hovered.scale.set(1,1,1); hovered = null; }
      tooltip.style.opacity = '0';
      canvas.style.cursor = 'default';
    }
  });
  canvas.addEventListener('mouseleave', () => { tooltip.style.opacity = '0'; });

  let t = 0;
  (function animate() {
    requestAnimationFrame(animate);
    t += 0.008;
    camera.position.x = Math.sin(t * 0.15) * 6;
    camera.position.y = 18 + Math.sin(t * 0.1) * 2;
    camera.lookAt(0, 3, 0);
    barMeshes.forEach((m, i) => {
      const pulse = 1 + Math.sin(t + i * 0.4) * 0.015;
      if (m !== hovered) m.scale.set(1, pulse, 1);
    });
    renderer.render(scene, camera);
  })();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DECISION TREE CANVAS (Three.js)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let treeInited = false;
function initTreeCanvas() {
  if (treeInited) return; treeInited = true;

  const canvas = document.getElementById('tree-canvas');
  const wrap   = document.getElementById('tree-canvas-wrap');
  const W = wrap.clientWidth, H = wrap.clientHeight;

  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
  renderer.setSize(W, H);

  const scene  = new THREE.Scene();
  const camera = new THREE.OrthographicCamera(-W/2/40, W/2/40, H/2/40, -H/2/40, 0.1, 100);
  camera.position.z = 50;

  // Tree structure (simplified representation of actual E2 tree)
  const nodes = [
    { id:0, label:'PctExtNullSelf\nRedirectHyperlinksRT', depth:0, x:0, y:5.5, type:'split', info:'Root split. RTâ‰¤âˆ’0.5 â†’ left (suspicious)' },
    { id:1, label:'SubmitInfoToEmail',      depth:1, x:-5, y:2.8, type:'split', info:'Email form submission?' },
    { id:2, label:'PctExtHyperlinks',       depth:1, x:5,  y:2.8, type:'split', info:'External hyperlink fraction' },
    { id:3, label:'InsecureForms',          depth:2, x:-7, y:0.3, type:'split', info:'HTTP form on HTTPS page?' },
    { id:4, label:'PHISHING',               depth:2, x:-2.5,y:0.3,type:'phish', info:'TP: Submit via email â†’ likely phishing' },
    { id:5, label:'FrequentDomain\nMismatch',depth:2, x:2.5,y:0.3, type:'split', info:'Domain mismatch present?' },
    { id:6, label:'LEGIT',                  depth:2, x:7,  y:0.3, type:'legit', info:'High external links + no mismatch â†’ legitimate' },
    { id:7, label:'PHISHING',               depth:3, x:-8.5,y:-2.5,type:'phish', info:'Insecure form â†’ phishing' },
    { id:8, label:'LEGIT',                  depth:3, x:-5.5,y:-2.5,type:'legit', info:'No insecure form â†’ legitimate' },
    { id:9, label:'PHISHING',               depth:3, x:1,  y:-2.5,type:'phish', info:'Domain mismatch â†’ phishing' },
    { id:10,label:'LEGIT',                  depth:3, x:4,  y:-2.5,type:'legit', info:'No mismatch, high ext links â†’ legitimate' },
  ];

  const edges = [
    [0,1,'â‰¤ âˆ’0.5'],[0,2,'> âˆ’0.5'],
    [1,3,'= 0'],[1,4,'= 1'],
    [2,5,'= 0'],[2,6,'> 0'],
    [3,7,'= 1'],[3,8,'= 0'],
    [5,9,'= 1'],[5,10,'= 0'],
  ];

  const nodeMeshes = [];

  // Draw edges first (lines)
  edges.forEach(([a, b, lbl]) => {
    const nA = nodes[a], nB = nodes[b];
    const pts = [new THREE.Vector3(nA.x, nA.y - 0.35, 0), new THREE.Vector3(nB.x, nB.y + 0.35, 0)];
    const geo = new THREE.BufferGeometry().setFromPoints(pts);
    const mat = new THREE.LineBasicMaterial({ color: 0x1a2340, linewidth: 1 });
    scene.add(new THREE.Line(geo, mat));
  });

  // Draw nodes
  nodes.forEach(n => {
    const isLeaf  = n.type === 'phish' || n.type === 'legit';
    const w = isLeaf ? 2.0 : 3.2, h = isLeaf ? 0.7 : 0.7;
    const geo = new THREE.PlaneGeometry(w, h);
    const c = n.type === 'phish' ? 0xff3366 : n.type === 'legit' ? 0x00ff9d : 0x00e5ff;
    const mat = new THREE.MeshBasicMaterial({ color: c, transparent: true, opacity: 0.15, side: THREE.DoubleSide });
    const mesh = new THREE.Mesh(geo, mat);
    mesh.position.set(n.x, n.y, 0);
    mesh.userData = { node: n };
    nodeMeshes.push(mesh);
    scene.add(mesh);

    // Border
    const bGeo = new THREE.EdgesGeometry(geo);
    const bMat = new THREE.LineBasicMaterial({ color: c, transparent: true, opacity: 0.7 });
    const border = new THREE.LineSegments(bGeo, bMat);
    border.position.set(n.x, n.y, 0.01);
    scene.add(border);
  });

  // Raycaster for tooltip
  const raycaster = new THREE.Raycaster();
  const mouse     = new THREE.Vector2(-999,-999);
  const tooltip   = document.getElementById('tree-tooltip');

  canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    mouse.x =  ((e.clientX - rect.left) / rect.width)  * 2 - 1;
    mouse.y = -((e.clientY - rect.top)  / rect.height) * 2 + 1;
    raycaster.setFromCamera(mouse, camera);
    const hits = raycaster.intersectObjects(nodeMeshes);
    if (hits.length) {
      const nd = hits[0].object.userData.node;
      tooltip.innerHTML = `<b style="color:#00e5ff">${nd.label.replace(/\n/,'<br>')}</b><br><span style="color:#4a5568">${nd.info}</span>`;
      tooltip.style.opacity = '1';
      tooltip.style.left = (e.clientX - wrap.getBoundingClientRect().left + 10) + 'px';
      tooltip.style.top  = (e.clientY - wrap.getBoundingClientRect().top  - 40) + 'px';
    } else {
      tooltip.style.opacity = '0';
    }
  });

  // Pan with mouse drag
  let isDragging = false, lastX = 0, lastY = 0;
  canvas.addEventListener('mousedown', e => { isDragging = true; lastX = e.clientX; lastY = e.clientY; });
  canvas.addEventListener('mousemove', e => {
    if (!isDragging) return;
    const dx = (e.clientX - lastX) / 40, dy = (e.clientY - lastY) / 40;
    camera.position.x -= dx; camera.position.y += dy;
    camera.left  = camera.position.x - W/2/40;
    camera.right = camera.position.x + W/2/40;
    camera.top   = camera.position.y + H/2/40;
    camera.bottom= camera.position.y - H/2/40;
    camera.updateProjectionMatrix();
    lastX = e.clientX; lastY = e.clientY;
  });
  canvas.addEventListener('mouseup', () => { isDragging = false; });

  (function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
  })();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FEATURE IMPORTANCE LIST (DOM)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function buildFeatureList() {
  const container = document.getElementById('importance-list');
  RF_IMPORTANCE.slice(0,8).forEach((d, i) => {
    const pct = (d.imp * 100).toFixed(1);
    const c = d.imp > 0.1 ? '#ff3366' : d.imp > 0.03 ? '#ffb800' : '#00e5ff';
    container.innerHTML += `
      <div style="margin-bottom:14px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px">
          <span style="font-family:'Space Mono',monospace;font-size:10px;color:#e2e8f0">${i+1}. ${d.feature}</span>
          <span style="font-family:'Space Mono',monospace;font-size:11px;font-weight:700;color:${c}">${pct}%</span>
        </div>
        <div style="height:3px;background:#1a2340;border-radius:2px;overflow:hidden">
          <div style="height:100%;width:${(d.imp/0.23*100).toFixed(0)}%;background:${c};border-radius:2px;transition:width 1s ease"></div>
        </div>
      </div>`;
  });
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FEATURE GROUP BREAKDOWN (DOM)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function buildGroups() {
  const container = document.getElementById('group-breakdown');
  Object.entries(FEATURE_GROUPS).forEach(([name, d]) => {
    container.innerHTML += `
      <div style="display:flex;align-items:center;gap:14px">
        <div style="width:10px;height:10px;border-radius:50%;background:${d.color};flex-shrink:0"></div>
        <div style="flex:1">
          <div style="display:flex;justify-content:space-between;margin-bottom:4px">
            <span style="font-size:12px;font-weight:600">${name}</span>
            <span style="font-family:'Space Mono',monospace;font-size:10px;color:#6b7280">${d.count} features Â· ${d.pct}%</span>
          </div>
          <div style="height:3px;background:#1a2340;border-radius:2px;overflow:hidden">
            <div style="height:100%;width:${d.pct}%;background:${d.color};opacity:0.7;border-radius:2px"></div>
          </div>
        </div>
      </div>`;
  });
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// BAR ANIMATION
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function animateBars() {
  setTimeout(() => {
    document.querySelectorAll('.metric-fill').forEach(el => {
      el.style.width = el.dataset.w + '%';
    });
  }, 100);
}
animateBars();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// URL PREDICTOR ENGINE
// Extracts real URL features client-side and scores with E1 LR coefficients
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Known brand names for EmbeddedBrandName detection
const BRANDS = ['paypal','amazon','google','facebook','apple','microsoft','netflix',
  'instagram','twitter','linkedin','dropbox','ebay','chase','wellsfargo','bankofamerica',
  'citibank','hsbc','barclays','lloyds','santander','steam','roblox','youtube','tiktok'];

// Sensitive words for NumSensitiveWords
const SENSITIVE = ['login','signin','sign-in','secure','security','update','verify',
  'verification','account','password','credential','bank','confirm','billing','payment',
  'invoice','alert','suspended','unlock','recover','restore'];

// Known TLDs that are legitimacy signals
const TRUSTED_TLDS = new Set(['com','org','net','edu','gov','io','co','uk','de','fr','jp','au','ca']);

// â”€â”€ Feature Extractor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function extractFeatures(rawUrl) {
  // Normalise â€” add scheme if missing so URL() doesn't throw
  let url = rawUrl.trim();
  if (!url) return null;
  if (!/^https?:\/\//i.test(url)) url = 'http://' + url;

  let parsed;
  try { parsed = new URL(url); } catch(e) { return null; }

  const full       = url;
  const hostname   = parsed.hostname.toLowerCase();
  const pathname   = parsed.pathname;
  const search     = parsed.search;
  const protocol   = parsed.protocol;       // 'http:' | 'https:'
  const hostParts  = hostname.split('.');

  // â”€â”€ URL Length & Structure â”€â”€
  const NumDots            = (full.match(/\./g)  || []).length;
  const SubdomainLevel     = Math.max(0, hostParts.length - 2);
  const PathLevel          = pathname.split('/').filter(Boolean).length;
  const UrlLength          = full.length;
  const HostnameLength     = hostname.length;
  const PathLength         = pathname.length;
  const QueryLength        = search.length;

  // â”€â”€ Suspicious Characters â”€â”€
  const NumDash            = (full.match(/-/g)   || []).length;
  const NumDashInHostname  = (hostname.match(/-/g) || []).length;
  const AtSymbol           = full.includes('@') ? 1 : 0;
  const TildeSymbol        = full.includes('~') ? 1 : 0;
  const NumUnderscore      = (full.match(/_/g)   || []).length;
  const NumPercent         = (full.match(/%/g)   || []).length;
  const NumQueryComponents = search ? search.slice(1).split('&').filter(Boolean).length : 0;
  const NumAmpersand       = (search.match(/&/g) || []).length;
  const NumHash            = (full.match(/#/g)   || []).length;
  const NumNumericChars    = (full.match(/\d/g)  || []).length;
  const DoubleSlashInPath  = pathname.includes('//') ? 1 : 0;

  // â”€â”€ Domain & Identity â”€â”€
  const NoHttps            = protocol === 'http:' ? 1 : 0;
  const IpAddress          = /^\d{1,3}(\.\d{1,3}){3}$/.test(hostname) ? 1 : 0;

  // Random string: entropy heuristic on the registered domain part
  const regDomain    = hostParts.slice(-2)[0] || '';
  const entropy      = shannonEntropy(regDomain);
  const RandomString = (entropy > 3.6 || /[0-9]{4,}/.test(regDomain)) ? 1 : 0;

  // EmbeddedBrandName: brand found in subdomain or path but NOT as the reg domain
  const EmbeddedBrandName = BRANDS.some(b =>
    (SubdomainLevel > 0 && hostname.split('.').slice(0,-2).join('.').includes(b)) ||
    (pathname.toLowerCase().includes(b) && !regDomain.includes(b))
  ) ? 1 : 0;

  // DomainInSubdomains / DomainInPaths â€” brand impersonation signals
  const subdomainStr = hostParts.slice(0, -2).join('.');
  const DomainInSubdomains = BRANDS.some(b => subdomainStr.includes(b)) ? 1 : 0;
  const DomainInPaths      = BRANDS.some(b => pathname.toLowerCase().includes(b)) ? 1 : 0;

  // HttpsInHostname: the word 'https' literally in hostname
  const HttpsInHostname    = hostname.includes('https') ? 1 : 0;

  // NumSensitiveWords across full URL
  const fullLower = full.toLowerCase();
  const NumSensitiveWords  = SENSITIVE.filter(w => fullLower.includes(w)).length;

  // FrequentDomainNameMismatch: heuristic â€” brand name embedded somewhere but reg domain is different
  const FrequentDomainNameMismatch = (EmbeddedBrandName && !BRANDS.includes(regDomain)) ? 1 : 0;

  // â”€â”€ RT (Rule-Based Threshold) encodings â”€â”€
  const SubdomainLevelRT = SubdomainLevel <= 1 ? 1 : SubdomainLevel === 2 ? 0 : -1;
  const UrlLengthRT      = UrlLength < 54 ? 1 : UrlLength <= 75 ? 0 : -1;
  // PctExtNullSelfRedirectHyperlinksRT: approximate from URL structure signals
  // Phishing URLs with many suspicious chars get score -1
  const suspScore = (AtSymbol + IpAddress + HttpsInHostname + FrequentDomainNameMismatch
                     + (NumDash > 4 ? 1 : 0) + (NumSensitiveWords > 2 ? 1 : 0));
  const PctExtNullSelfRedirectHyperlinksRT = suspScore >= 3 ? -1 : suspScore === 0 ? 1 : 0;

  return {
    // returned as object for display + scoring
    NumDots, SubdomainLevel, PathLevel, UrlLength, HostnameLength, PathLength, QueryLength,
    NumDash, NumDashInHostname, AtSymbol, TildeSymbol, NumUnderscore, NumPercent,
    NumQueryComponents, NumAmpersand, NumHash, NumNumericChars, DoubleSlashInPath,
    NoHttps, IpAddress, RandomString, EmbeddedBrandName, DomainInSubdomains,
    DomainInPaths, HttpsInHostname, NumSensitiveWords, FrequentDomainNameMismatch,
    SubdomainLevelRT, UrlLengthRT, PctExtNullSelfRedirectHyperlinksRT,
    // meta
    _hostname: hostname, _protocol: protocol, _regDomain: regDomain,
    _entropy: entropy.toFixed(2)
  };
}

function shannonEntropy(str) {
  if (!str) return 0;
  const freq = {};
  for (const c of str) freq[c] = (freq[c] || 0) + 1;
  return Object.values(freq).reduce((h, f) => {
    const p = f / str.length;
    return h - p * Math.log2(p);
  }, 0);
}

// â”€â”€ Logistic Regression Scorer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Uses E1 full-model coefficients (scaled; approximated normalization)
const FULL_COEF = {
  PctExtNullSelfRedirectHyperlinksRT:  -3.407,
  NumQueryComponents:                  -2.453,
  FrequentDomainNameMismatch:          +2.071,
  NoHttps:                             +1.520,
  IpAddress:                           +1.096,
  HttpsInHostname:                     +1.340,
  EmbeddedBrandName:                   +0.920,
  NumSensitiveWords:                   +0.720,
  AtSymbol:                            +1.050,
  NumDashInHostname:                   +0.631,
  RandomString:                        +0.680,
  UrlLength:                           +0.440,
  NumDash:                             -0.350,   // negative in full model (collinear)
  SubdomainLevel:                      +0.480,
  NumDots:                             +0.380,
  DoubleSlashInPath:                   +0.550,
  DomainInSubdomains:                  +0.800,
  DomainInPaths:                       +0.620,
  SubdomainLevelRT:                    -1.100,
  UrlLengthRT:                         -0.900,
};

// Approximate normalization stats (from dataset distribution)
const NORM = {
  PctExtNullSelfRedirectHyperlinksRT: [0.14, 0.80],
  NumQueryComponents:  [1.8,  3.0],
  FrequentDomainNameMismatch: [0.10, 0.30],
  NoHttps:             [0.40, 0.49],
  IpAddress:           [0.05, 0.22],
  HttpsInHostname:     [0.04, 0.20],
  EmbeddedBrandName:   [0.12, 0.32],
  NumSensitiveWords:   [0.9,  1.4],
  AtSymbol:            [0.02, 0.14],
  NumDashInHostname:   [0.5,  1.2],
  RandomString:        [0.25, 0.43],
  UrlLength:           [74,   46],
  NumDash:             [2.4,  3.2],
  SubdomainLevel:      [1.1,  1.0],
  NumDots:             [3.2,  1.8],
  DoubleSlashInPath:   [0.05, 0.22],
  DomainInSubdomains:  [0.08, 0.27],
  DomainInPaths:       [0.10, 0.30],
  SubdomainLevelRT:    [0.30, 0.75],
  UrlLengthRT:         [0.25, 0.72],
};

function scoreURL(feats) {
  let logit = -0.08;
  for (const [feat, coef] of Object.entries(FULL_COEF)) {
    if (feats[feat] === undefined) continue;
    const [mu, sd] = NORM[feat] || [0, 1];
    const z = (feats[feat] - mu) / (sd || 1);
    logit += coef * z;
  }
  return 1 / (1 + Math.exp(-logit));
}

// â”€â”€ Display Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onURLInput(val) {
  document.getElementById('clear-btn').style.display = val ? 'block' : 'none';
}
function clearURL() {
  document.getElementById('url-input').value = '';
  document.getElementById('clear-btn').style.display = 'none';
  document.getElementById('pred-results').style.display = 'none';
  document.getElementById('url-input').focus();
}
function pasteExample(url) {
  document.getElementById('url-input').value = url;
  onURLInput(url);
  analyzeURL();
}

function analyzeURL() {
  const raw   = document.getElementById('url-input').value.trim();
  if (!raw) return;

  // Button loading state
  const btn = document.getElementById('analyze-btn');
  btn.classList.add('loading');
  btn.querySelector('#btn-text').textContent = 'SCANNINGâ€¦';

  setTimeout(() => {
    btn.classList.remove('loading');
    btn.querySelector('#btn-text').textContent = 'ANALYZE';

    const feats = extractFeatures(raw);
    if (!feats) {
      alert('Could not parse URL. Please check the format.');
      return;
    }

    const prob    = scoreURL(feats);
    const isPhish = prob > 0.5;
    const conf    = Math.abs(prob - 0.5) * 200;

    // Show results
    const res = document.getElementById('pred-results');
    res.style.display = 'block';

    // â”€â”€ Verdict banner
    const banner = document.getElementById('verdict-banner');
    banner.className = isPhish ? 'phish' : 'legit';

    const icon = document.getElementById('verdict-icon');
    icon.className = isPhish ? 'phish' : 'legit';
    icon.textContent = isPhish ? 'âš ' : 'âœ“';

    document.getElementById('verdict-label').textContent  = isPhish ? 'âš  PHISHING' : 'âœ“ LEGITIMATE';
    document.getElementById('verdict-label').className    = 'phish legit'.includes(isPhish?'phish':'legit') ? (isPhish ? 'phish' : 'legit') : '';
    document.getElementById('verdict-label').className = isPhish ? 'phish' : 'legit';
    document.getElementById('verdict-prob-text').textContent =
      `Phishing probability: ${(prob*100).toFixed(1)}%  Â·  Confidence: ${conf.toFixed(0)}%  Â·  Model: E1 Logistic Regression`;
    document.getElementById('verdict-url-display').textContent = raw.length > 70 ? raw.slice(0,67)+'â€¦' : raw;

    // Gauge
    drawGauge(prob);

    // Prob bar
    const pct = (prob * 100).toFixed(1);
    document.getElementById('prob-bar-fill').style.width = pct + '%';
    document.getElementById('prob-bar-marker').style.left = pct + '%';

    // Feature evidence cards
    renderFeatureCards(feats, isPhish);

    // Decision trace
    renderDecisionTrace(feats, prob, isPhish);

    // Scroll to results
    res.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 380);
}

function drawGauge(prob) {
  const canvas = document.getElementById('gauge-canvas');
  const ctx    = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  const cx = W/2, cy = H/2 + 10;
  const r  = 52;

  ctx.clearRect(0, 0, W, H);

  // Background arc
  ctx.beginPath();
  ctx.arc(cx, cy, r, Math.PI, 2*Math.PI);
  ctx.strokeStyle = '#1a2340';
  ctx.lineWidth = 10;
  ctx.lineCap = 'round';
  ctx.stroke();

  // Filled arc â€” greenâ†’red gradient
  const angle = Math.PI + prob * Math.PI;
  const grad  = ctx.createLinearGradient(cx-r, cy, cx+r, cy);
  grad.addColorStop(0,   '#00ff9d');
  grad.addColorStop(0.5, '#ffb800');
  grad.addColorStop(1,   '#ff3366');
  ctx.beginPath();
  ctx.arc(cx, cy, r, Math.PI, angle);
  ctx.strokeStyle = grad;
  ctx.lineWidth = 10;
  ctx.stroke();

  // Center label
  ctx.fillStyle = prob > 0.5 ? '#ff3366' : '#00ff9d';
  ctx.font = 'bold 22px Syne, sans-serif';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(`${(prob*100).toFixed(0)}%`, cx, cy - 8);
  ctx.fillStyle = '#4a5568';
  ctx.font = '9px monospace';
  ctx.fillText('RISK', cx, cy + 14);
}

function renderFeatureCards(feats, isPhish) {
  const grid = document.getElementById('feature-evidence-grid');

  // Feature display spec: [key, label, description, badThreshold, direction]
  const specs = [
    ['NoHttps',           'No HTTPS',          'HTTP = no encryption',         0.5, 'high=bad'],
    ['IpAddress',         'IP as Hostname',     'e.g. http://192.168.1.1/...',  0.5, 'high=bad'],
    ['AtSymbol',          '@ Symbol',           'Tricks browser into ignoring domain before @', 0.5, 'high=bad'],
    ['HttpsInHostname',   '"https" in Host',    'e.g. https-paypal.attacker.com', 0.5, 'high=bad'],
    ['FrequentDomainNameMismatch','Domain Mismatch','Brand in URL â‰  registered domain', 0.5,'high=bad'],
    ['EmbeddedBrandName', 'Brand Embedded',     'Known brand in path/subdomain', 0.5, 'high=bad'],
    ['NumSensitiveWords', 'Sensitive Words',    'login, verify, account, secureâ€¦', 2, 'high=bad'],
    ['NumDash',           'Hyphens',            'paypal-secure-login.com',      4, 'high=bad'],
    ['SubdomainLevel',    'Subdomain Depth',    'Nested subdomains (>2 suspicious)', 2, 'high=bad'],
    ['UrlLength',         'URL Length',         'â‰¤54 safe Â· >75 suspicious',    75, 'high=bad'],
    ['NumQueryComponents','Query Params',       'Number of ?key=value pairs',   4, 'high=bad'],
    ['DoubleSlashInPath', 'Double Slash //',    'Path injection indicator',     0.5,'high=bad'],
    ['RandomString',      'Random Domain',      'High entropy = auto-generated',0.5,'high=bad'],
    ['DomainInSubdomains','Brand in Subdomain', 'paypal.attacker.com',          0.5,'high=bad'],
    ['SubdomainLevelRT',  'Subdomain RT',       '-1=suspicious 0=ambiguous 1=safe', 0, 'low=bad'],
    ['UrlLengthRT',       'URL Length RT',      '-1=long 0=medium 1=short',     0, 'low=bad'],
    ['PctExtNullSelfRedirectHyperlinksRT','Null-Redirect RT','RT encoded null-link fraction', 0, 'low=bad'],
  ];

  grid.innerHTML = specs.map(([key, label, desc, thresh, dir]) => {
    const val = feats[key];
    if (val === undefined) return '';
    const isBad  = dir === 'high=bad' ? val > thresh : val < thresh;
    const isWarn = !isBad && (dir === 'high=bad' ? val === thresh : val === thresh);
    const cls    = isBad ? 'bad' : (val !== 0 && val !== 1 && Math.abs(val) <= 1) ? 'warn' : 'good';
    const disp   = typeof val === 'number' && val % 1 !== 0 ? val.toFixed(2) : val;
    return `<div class="feat-ev-card ${isBad ? 'bad' : 'good'}">
      <div class="feat-ev-name">${label}</div>
      <div class="feat-ev-val">${disp}</div>
      <div class="feat-ev-desc">${desc}</div>
    </div>`;
  }).join('');
}

function renderDecisionTrace(feats, prob, isPhish) {
  const steps = [];

  // Build an ordered list of evidence
  if (feats.IpAddress) steps.push({ cls:'bad',  text:'<b>IP address</b> used as hostname â€” bypasses DNS verification entirely.' });
  if (feats.HttpsInHostname) steps.push({ cls:'bad', text:'Literal <b>"https"</b> found inside the hostname â€” a deception technique.' });
  if (feats.AtSymbol) steps.push({ cls:'bad',  text:'<b>@ symbol</b> present â€” browser ignores everything before it, spoofing the domain.' });
  if (feats.FrequentDomainNameMismatch) steps.push({ cls:'bad', text:'<b>Domain name mismatch</b> detected â€” a known brand appears in URL but the registered domain is different.' });
  if (feats.EmbeddedBrandName) steps.push({ cls:'bad', text:`<b>Known brand</b> embedded in subdomain or path while actual domain is "${feats._regDomain}".` });
  if (feats.NumSensitiveWords > 2) steps.push({ cls:'bad', text:`<b>${feats.NumSensitiveWords} sensitive words</b> found (login, verify, secureâ€¦) â€” high-pressure vocabulary.` });
  if (feats.NoHttps) steps.push({ cls:'warn', text:'<b>HTTP</b> scheme â€” no TLS encryption. Not definitive alone but adds risk.' });
  if (feats.SubdomainLevel > 2) steps.push({ cls:'bad', text:`<b>Subdomain depth ${feats.SubdomainLevel}</b> â€” legitimate sites rarely exceed 2 levels.` });
  if (feats.UrlLength > 100) steps.push({ cls:'warn', text:`<b>URL length ${feats.UrlLength}</b> â€” excessively long URLs obscure the real domain in browser bars.` });
  if (feats.NumDash > 4) steps.push({ cls:'warn', text:`<b>${feats.NumDash} hyphens</b> â€” high hyphen count suggests brand-mimicry (e.g., paypal-secure-login.com).` });
  if (feats.RandomString) steps.push({ cls:'warn', text:`<b>Domain entropy ${feats._entropy}</b> â€” hostname appears auto-generated or random.` });
  if (feats.DoubleSlashInPath) steps.push({ cls:'warn', text:'<b>Double slash</b> in path â€” potential authority injection.' });
  if (feats.DomainInSubdomains) steps.push({ cls:'bad', text:'Known brand name found <b>in subdomain</b> â€” classic brand impersonation pattern.' });

  // Positive signals
  if (!feats.NoHttps) steps.push({ cls:'good', text:'<b>HTTPS</b> present â€” encrypted connection (necessary but not sufficient for safety).' });
  if (feats.SubdomainLevel <= 1) steps.push({ cls:'good', text:`<b>Subdomain depth ${feats.SubdomainLevel}</b> â€” within normal range for legitimate sites.` });
  if (!feats.IpAddress && !feats.RandomString) steps.push({ cls:'good', text:'Hostname appears to be a <b>genuine domain name</b>, not an IP or random string.' });
  if (feats.NumSensitiveWords === 0) steps.push({ cls:'good', text:'<b>No sensitive vocabulary</b> (login, verify, account) found in URL.' });

  // Final verdict step
  steps.push({ cls: isPhish ? 'bad' : 'good', text:
    `<b>Final score: ${(prob*100).toFixed(1)}%</b> phishing probability â†’ verdict: <b>${isPhish ? 'PHISHING' : 'LEGITIMATE'}</b> (threshold 50%).`
  });

  const container = document.getElementById('decision-path');
  container.innerHTML = steps.map((s, i) => `
    <div class="dp-step ${s.cls}" style="animation-delay:${i*0.06}s">
      <div class="dp-dot"></div>
      <div class="dp-text">${s.text}</div>
    </div>`).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INTERSECTION OBSERVER â€” animate bars on scroll into view
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const observer = new IntersectionObserver(entries => {
  entries.forEach(e => { if (e.isIntersecting) animateBars(); });
}, { threshold: 0.1 });
document.querySelectorAll('.exp-card').forEach(el => observer.observe(el));
</script>
</body>
</html>
